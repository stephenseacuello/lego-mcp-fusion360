<!DOCTYPE html>
<html lang="en" data-theme="{{ session.get('theme', 'auto') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LEGO MCP Dashboard{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß±</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block styles %}{% endblock %}
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a href="{{ url_for('main.index') }}" class="logo">
                <span class="logo-icon">üß±</span>
                <span class="logo-text">LEGO MCP</span>
            </a>
        </div>
        
        <div class="header-center">
            <div class="search-box">
                <input type="text" id="globalSearch" placeholder="Search bricks..." autocomplete="off">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="status-indicators">
                <span class="status-dot {{ 'connected' if services_status.get('fusion360') == 'connected' else 'disconnected' }}" 
                      title="Fusion 360: {{ services_status.get('fusion360', 'unknown') }}"></span>
                <span class="status-dot {{ 'connected' if services_status.get('slicer') == 'connected' else 'disconnected' }}"
                      title="Slicer: {{ services_status.get('slicer', 'unknown') }}"></span>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <span class="theme-icon">üåì</span>
            </button>
        </div>
    </header>
    
    <!-- Main Layout -->
    <div class="layout">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <ul class="nav-list">
                <li class="nav-item {{ 'active' if request.endpoint == 'main.index' else '' }}">
                    <a href="{{ url_for('main.index') }}">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-section">Digital Twin</li>
                
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('workspace') else '' }}">
                    <a href="{{ url_for('workspace.workspace') }}">
                        <span class="nav-icon">üéØ</span>
                        <span class="nav-text">Workspace</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('scan') else '' }}">
                    <a href="{{ url_for('scan.scan_page') }}">
                        <span class="nav-icon">üì∑</span>
                        <span class="nav-text">Scan</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('collection') else '' }}">
                    <a href="{{ url_for('collection.collection_page') }}">
                        <span class="nav-icon">üì¶</span>
                        <span class="nav-text">My Collection</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('builds') else '' }}">
                    <a href="{{ url_for('builds.builds_page') }}">
                        <span class="nav-icon">üèóÔ∏è</span>
                        <span class="nav-text">Builds</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('insights') else '' }}">
                    <a href="{{ url_for('insights.insights_page') }}">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Insights</span>
                    </a>
                </li>
                
                <li class="nav-section">MCP Tools</li>
                
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('catalog') else '' }}">
                    <a href="{{ url_for('catalog.list_bricks') }}">
                        <span class="nav-icon">üìö</span>
                        <span class="nav-text">Brick Catalog</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('builder') else '' }}">
                    <a href="{{ url_for('builder.builder') }}">
                        <span class="nav-icon">üî®</span>
                        <span class="nav-text">Builder</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('files') else '' }}">
                    <a href="{{ url_for('files.browse') }}">
                        <span class="nav-icon">üìÅ</span>
                        <span class="nav-text">Files</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('history') else '' }}">
                    <a href="{{ url_for('history.history_list') }}">
                        <span class="nav-icon">üìú</span>
                        <span class="nav-text">History</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('tools') else '' }}">
                    <a href="{{ url_for('tools.playground') }}">
                        <span class="nav-icon">üß™</span>
                        <span class="nav-text">Tools</span>
                    </a>
                </li>
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('status') else '' }}">
                    <a href="{{ url_for('status.status_page') }}">
                        <span class="nav-icon">‚ö°</span>
                        <span class="nav-text">Status</span>
                    </a>
                </li>
                
                <li class="nav-divider"></li>
                
                <li class="nav-item {{ 'active' if request.endpoint and request.endpoint.startswith('settings') else '' }}">
                    <a href="{{ url_for('settings.settings_page') }}">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle"></h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>
    
    <!-- Scripts -->
    <!-- Socket.IO for real-time updates -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- Three.js from CDN for 3D preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
