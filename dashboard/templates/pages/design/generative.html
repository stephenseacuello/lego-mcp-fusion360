{% extends "base.html" %}
{% block title %}Generative Design Studio - LEGO MCP v6.0{% endblock %}

{% block extra_css %}
<style>
    :root {
        --gen-primary: #ec4899;
        --gen-secondary: #8b5cf6;
        --gen-tertiary: #06b6d4;
        --gen-success: #10b981;
        --gen-warning: #f59e0b;
        --gen-danger: #ef4444;
        --gen-dark: #1a1a2e;
        --gen-darker: #0f0f1a;
        --gen-card-bg: rgba(255,255,255,0.03);
        --gen-border: rgba(255,255,255,0.08);
        --gen-text: #e0e0e0;
        --gen-text-muted: #888;
    }

    .gen-page {
        background: linear-gradient(135deg, var(--gen-darker) 0%, var(--gen-dark) 100%);
        min-height: 100vh;
        color: var(--gen-text);
    }

    /* Header Section */
    .page-header-section {
        background: linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
        border-bottom: 1px solid rgba(236, 72, 153, 0.3);
        padding: 20px 25px;
        margin-bottom: 20px;
    }

    .page-header-section h1 {
        font-size: 1.7rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .page-header-section h1 i {
        color: var(--gen-primary);
    }

    .page-header-section p {
        margin: 6px 0 0 0;
        color: var(--gen-text-muted);
        font-size: 0.9rem;
    }

    /* Connection Status */
    .connection-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        padding: 6px 14px;
        background: rgba(0,0,0,0.3);
        border-radius: 20px;
        border: 1px solid var(--gen-border);
    }

    .connection-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--gen-text-muted);
    }

    .connection-dot.connected {
        background: var(--gen-success);
        animation: pulse 2s infinite;
    }

    .connection-dot.connecting {
        background: var(--gen-warning);
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.15); }
    }

    /* KPI Grid */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
        padding: 0 20px;
        margin-bottom: 20px;
    }

    .kpi-card {
        background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
        border: 1px solid var(--gen-border);
        border-radius: 10px;
        padding: 14px;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .kpi-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(236, 72, 153, 0.2);
    }

    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--gen-primary), var(--gen-secondary));
    }

    .kpi-card.secondary::before { background: linear-gradient(90deg, var(--gen-secondary), #a78bfa); }
    .kpi-card.tertiary::before { background: linear-gradient(90deg, var(--gen-tertiary), #22d3ee); }
    .kpi-card.success::before { background: linear-gradient(90deg, var(--gen-success), #34d399); }
    .kpi-card.warning::before { background: linear-gradient(90deg, var(--gen-warning), #fbbf24); }
    .kpi-card.danger::before { background: linear-gradient(90deg, var(--gen-danger), #f87171); }

    .kpi-value {
        font-size: 1.6rem;
        font-weight: 700;
        color: #fff;
        line-height: 1.2;
    }

    .kpi-label {
        font-size: 0.7rem;
        color: var(--gen-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 4px;
    }

    .kpi-trend {
        font-size: 0.7rem;
        margin-top: 4px;
    }

    .kpi-trend.up { color: var(--gen-success); }
    .kpi-trend.down { color: var(--gen-danger); }

    /* Main Layout */
    .gen-layout {
        display: grid;
        grid-template-columns: 320px 1fr 360px;
        gap: 15px;
        padding: 0 20px;
        height: calc(100vh - 220px);
    }

    .panel {
        background: linear-gradient(145deg, var(--gen-card-bg) 0%, rgba(255,255,255,0.01) 100%);
        border: 1px solid var(--gen-border);
        border-radius: 10px;
        padding: 15px;
        overflow-y: auto;
    }

    .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 14px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--gen-border);
    }

    .panel-header-left {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .panel-header i {
        color: var(--gen-primary);
    }

    .panel-badge {
        font-size: 0.65rem;
        padding: 2px 8px;
        border-radius: 10px;
        background: rgba(236, 72, 153, 0.2);
        color: var(--gen-primary);
    }

    /* Tabs */
    .panel-tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 14px;
        background: rgba(0,0,0,0.2);
        padding: 4px;
        border-radius: 8px;
    }

    .panel-tab {
        flex: 1;
        padding: 8px 12px;
        background: transparent;
        border: none;
        border-radius: 6px;
        color: var(--gen-text-muted);
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .panel-tab:hover {
        color: var(--gen-text);
    }

    .panel-tab.active {
        background: var(--gen-primary);
        color: white;
    }

    /* Form Controls */
    .form-group {
        margin-bottom: 14px;
    }

    .form-group label {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.8rem;
        font-weight: 500;
        color: #aaa;
        margin-bottom: 5px;
    }

    .label-hint {
        font-size: 0.7rem;
        color: var(--gen-text-muted);
        font-weight: 400;
    }

    .form-group select,
    .form-group input[type="number"],
    .form-group input[type="text"] {
        width: 100%;
        padding: 9px 11px;
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 6px;
        background: rgba(0,0,0,0.3);
        color: #fff;
        font-size: 0.85rem;
        transition: all 0.2s;
    }

    .form-group select:focus,
    .form-group input:focus {
        outline: none;
        border-color: var(--gen-primary);
        box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.2);
    }

    .input-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 5px;
    }

    .input-grid input {
        text-align: center;
    }

    .range-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .range-container input[type="range"] {
        flex: 1;
        height: 5px;
        border-radius: 3px;
        background: rgba(255,255,255,0.1);
        -webkit-appearance: none;
    }

    .range-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--gen-primary);
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(236, 72, 153, 0.4);
    }

    .range-value {
        min-width: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--gen-primary);
        text-align: right;
    }

    /* Buttons */
    .btn {
        width: 100%;
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 8px;
        transition: all 0.2s;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--gen-primary) 0%, #db2777 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
    }

    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .btn-secondary {
        background: rgba(255,255,255,0.1);
        color: #fff;
        border: 1px solid rgba(255,255,255,0.2);
    }

    .btn-secondary:hover {
        background: rgba(255,255,255,0.15);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--gen-success) 0%, #059669 100%);
        color: white;
    }

    .btn-success:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-small {
        width: auto;
        padding: 6px 12px;
        font-size: 0.8rem;
        margin: 0;
    }

    .btn-icon {
        padding: 8px 10px;
        width: auto;
        margin: 0;
    }

    /* Material Cards */
    .material-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin-bottom: 12px;
    }

    .material-card {
        padding: 10px;
        border: 2px solid var(--gen-border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
    }

    .material-card:hover {
        border-color: rgba(236, 72, 153, 0.5);
    }

    .material-card.selected {
        border-color: var(--gen-primary);
        background: rgba(236, 72, 153, 0.1);
    }

    .material-name {
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .material-props {
        font-size: 0.65rem;
        color: var(--gen-text-muted);
    }

    .material-badge {
        display: inline-block;
        font-size: 0.6rem;
        padding: 2px 6px;
        border-radius: 8px;
        margin-top: 4px;
    }

    .material-badge.recommended {
        background: rgba(16, 185, 129, 0.2);
        color: var(--gen-success);
    }

    /* Constraint Tags */
    .constraint-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .constraint-tag {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        background: rgba(139, 92, 246, 0.2);
        color: var(--gen-secondary);
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .constraint-tag:hover {
        background: rgba(139, 92, 246, 0.3);
    }

    .constraint-tag.disabled {
        opacity: 0.5;
        text-decoration: line-through;
    }

    .constraint-tag i { font-size: 0.6rem; }

    /* Lattice Options */
    .lattice-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-top: 10px;
    }

    .lattice-option {
        padding: 10px 6px;
        border: 2px solid var(--gen-border);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .lattice-option:hover {
        border-color: rgba(236, 72, 153, 0.5);
        transform: translateY(-2px);
    }

    .lattice-option.selected {
        border-color: var(--gen-primary);
        background: rgba(236, 72, 153, 0.15);
    }

    .lattice-icon {
        font-size: 1.5rem;
        margin-bottom: 4px;
    }

    .lattice-name {
        font-size: 0.7rem;
        color: #aaa;
    }

    /* 3D Viewer */
    .viewer-container {
        background: linear-gradient(145deg, #0a0a14 0%, #12121e 100%);
        border: 1px solid var(--gen-border);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .viewer-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: rgba(255,255,255,0.03);
        border-bottom: 1px solid var(--gen-border);
    }

    .viewer-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
    }

    .viewer-title i {
        color: var(--gen-primary);
    }

    .viewer-mode-badge {
        font-size: 0.65rem;
        padding: 2px 8px;
        border-radius: 10px;
        background: rgba(6, 182, 212, 0.2);
        color: var(--gen-tertiary);
    }

    .viewer-actions {
        display: flex;
        gap: 6px;
    }

    .viewer-btn {
        background: rgba(255,255,255,0.08);
        border: 1px solid var(--gen-border);
        color: #aaa;
        padding: 6px 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .viewer-btn:hover {
        background: rgba(255,255,255,0.12);
        color: #fff;
    }

    .viewer-btn.active {
        background: rgba(236, 72, 153, 0.2);
        color: var(--gen-primary);
        border-color: var(--gen-primary);
    }

    .viewer-3d {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        min-height: 300px;
    }

    .viewer-placeholder {
        text-align: center;
        color: #555;
    }

    .viewer-placeholder i {
        font-size: 5rem;
        color: var(--gen-primary);
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .viewer-placeholder p {
        color: var(--gen-text-muted);
        margin: 0;
    }

    .viewer-controls {
        display: flex;
        justify-content: center;
        gap: 8px;
        padding: 12px;
        background: rgba(255,255,255,0.03);
        border-top: 1px solid var(--gen-border);
    }

    .control-btn {
        background: rgba(255,255,255,0.06);
        border: 1px solid var(--gen-border);
        color: #aaa;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.2s;
    }

    .control-btn:hover {
        background: rgba(255,255,255,0.1);
        color: #fff;
    }

    /* Chart Container */
    .chart-container {
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
    }

    .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .chart-title {
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .chart-title i {
        color: var(--gen-primary);
        font-size: 0.8rem;
    }

    .chart-actions {
        display: flex;
        gap: 4px;
    }

    .chart-btn {
        background: transparent;
        border: none;
        color: var(--gen-text-muted);
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.7rem;
    }

    .chart-btn:hover {
        color: var(--gen-text);
        background: rgba(255,255,255,0.1);
    }

    .chart-btn.active {
        color: var(--gen-primary);
    }

    /* Optimization Status */
    .optimization-status {
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 14px;
        margin-bottom: 14px;
    }

    .optimization-status.running {
        background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border: 1px solid rgba(236, 72, 153, 0.3);
    }

    .optimization-status.complete {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .status-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--gen-text-muted);
    }

    .status-indicator.running {
        background: var(--gen-primary);
        animation: statusPulse 1.5s infinite;
    }

    .status-indicator.complete {
        background: var(--gen-success);
    }

    @keyframes statusPulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.2); }
    }

    .progress-bar {
        height: 6px;
        background: rgba(255,255,255,0.1);
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--gen-primary), var(--gen-secondary));
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    .status-details {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-top: 12px;
    }

    .detail-item {
        text-align: center;
        padding: 8px;
        background: rgba(0,0,0,0.2);
        border-radius: 6px;
    }

    .detail-value {
        font-size: 1rem;
        font-weight: 700;
        color: #fff;
    }

    .detail-label {
        font-size: 0.6rem;
        color: var(--gen-text-muted);
        text-transform: uppercase;
        margin-top: 2px;
    }

    /* Fitness Scores */
    .fitness-card {
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
    }

    .fitness-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .fitness-name {
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .fitness-name i {
        font-size: 0.9rem;
    }

    .fitness-score {
        font-weight: 700;
        font-size: 1rem;
    }

    .fitness-bar {
        height: 5px;
        background: rgba(255,255,255,0.1);
        border-radius: 3px;
        overflow: hidden;
    }

    .fitness-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.5s ease;
    }

    .fitness-fill.strength { background: linear-gradient(90deg, #f59e0b, #eab308); }
    .fitness-fill.printability { background: linear-gradient(90deg, #10b981, #34d399); }
    .fitness-fill.material { background: linear-gradient(90deg, #06b6d4, #22d3ee); }
    .fitness-fill.compatibility { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }

    /* Analysis Results */
    .analysis-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin-top: 12px;
    }

    .analysis-item {
        background: rgba(0,0,0,0.2);
        border-radius: 6px;
        padding: 10px;
        text-align: center;
    }

    .analysis-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #fff;
    }

    .analysis-label {
        font-size: 0.7rem;
        color: var(--gen-text-muted);
        margin-top: 2px;
    }

    .analysis-value.good { color: var(--gen-success); }
    .analysis-value.warning { color: var(--gen-warning); }
    .analysis-value.danger { color: var(--gen-danger); }

    /* Design Gallery */
    .design-gallery {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 12px;
    }

    .gallery-item {
        aspect-ratio: 1;
        background: rgba(0,0,0,0.3);
        border: 2px solid var(--gen-border);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
    }

    .gallery-item:hover {
        border-color: var(--gen-primary);
        transform: scale(1.02);
    }

    .gallery-item.selected {
        border-color: var(--gen-primary);
        background: rgba(236, 72, 153, 0.1);
    }

    .gallery-item i {
        font-size: 1.8rem;
        color: var(--gen-primary);
        opacity: 0.7;
    }

    .gallery-item .gallery-score {
        position: absolute;
        bottom: 4px;
        right: 4px;
        font-size: 0.65rem;
        font-weight: 700;
        background: rgba(0,0,0,0.7);
        padding: 2px 6px;
        border-radius: 4px;
        color: var(--gen-success);
    }

    .gallery-item .gallery-label {
        font-size: 0.6rem;
        color: var(--gen-text-muted);
        margin-top: 4px;
    }

    /* History List */
    .history-list {
        max-height: 200px;
        overflow-y: auto;
    }

    .history-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: rgba(0,0,0,0.2);
        border-radius: 6px;
        margin-bottom: 6px;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
    }

    .history-item:hover {
        background: rgba(255,255,255,0.05);
        border-color: var(--gen-border);
    }

    .history-thumb {
        width: 36px;
        height: 36px;
        background: rgba(236, 72, 153, 0.2);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gen-primary);
    }

    .history-info {
        flex: 1;
        min-width: 0;
    }

    .history-name {
        font-size: 0.85rem;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .history-meta {
        font-size: 0.7rem;
        color: var(--gen-text-muted);
    }

    .history-score {
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--gen-success);
    }

    /* LEGO Validation */
    .validation-card {
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 14px;
        margin-top: 12px;
    }

    .validation-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
    }

    .validation-badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .validation-badge.pass {
        background: rgba(16, 185, 129, 0.2);
        color: var(--gen-success);
    }

    .validation-badge.fail {
        background: rgba(239, 68, 68, 0.2);
        color: var(--gen-danger);
    }

    .validation-checks {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
    }

    .check-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 10px;
        background: rgba(255,255,255,0.03);
        border-radius: 4px;
        font-size: 0.75rem;
    }

    .check-item i {
        font-size: 0.7rem;
    }

    .check-item i.pass { color: var(--gen-success); }
    .check-item i.fail { color: var(--gen-danger); }

    /* Comparison Mode */
    .comparison-container {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 12px;
    }

    .comparison-container.active {
        display: grid;
    }

    .comparison-card {
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 12px;
        border: 2px solid transparent;
    }

    .comparison-card.a {
        border-color: var(--gen-primary);
    }

    .comparison-card.b {
        border-color: var(--gen-tertiary);
    }

    .comparison-label {
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .comparison-label.a { color: var(--gen-primary); }
    .comparison-label.b { color: var(--gen-tertiary); }

    /* Export Panel */
    .export-panel {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        width: 400px;
        height: 100vh;
        background: var(--gen-dark);
        border-left: 1px solid var(--gen-border);
        padding: 20px;
        z-index: 1000;
        overflow-y: auto;
        animation: slideInRight 0.3s ease;
    }

    .export-panel.active {
        display: block;
    }

    @keyframes slideInRight {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
    }

    .export-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: transparent;
        border: none;
        color: var(--gen-text-muted);
        font-size: 1.2rem;
        cursor: pointer;
    }

    .export-format-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 20px;
    }

    .export-format {
        padding: 15px;
        background: rgba(255,255,255,0.05);
        border: 2px solid var(--gen-border);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .export-format:hover {
        border-color: var(--gen-primary);
    }

    .export-format.selected {
        border-color: var(--gen-primary);
        background: rgba(236, 72, 153, 0.1);
    }

    .export-format i {
        font-size: 1.5rem;
        margin-bottom: 8px;
        color: var(--gen-primary);
    }

    .export-format-name {
        font-weight: 600;
        font-size: 0.9rem;
    }

    .export-format-desc {
        font-size: 0.7rem;
        color: var(--gen-text-muted);
        margin-top: 2px;
    }

    /* Settings Modal */
    .settings-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .settings-overlay.active {
        display: flex;
    }

    .settings-modal {
        background: var(--gen-dark);
        border: 1px solid var(--gen-border);
        border-radius: 12px;
        width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        padding: 20px;
    }

    .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--gen-border);
    }

    .settings-section {
        margin-bottom: 20px;
    }

    .settings-section-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--gen-primary);
    }

    /* Toast Notifications */
    .toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1050;
    }

    .toast {
        background: var(--gen-dark);
        border: 1px solid var(--gen-border);
        border-radius: 8px;
        padding: 12px 16px;
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 300px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .toast.success { border-left: 3px solid var(--gen-success); }
    .toast.info { border-left: 3px solid var(--gen-tertiary); }
    .toast.warning { border-left: 3px solid var(--gen-warning); }
    .toast.error { border-left: 3px solid var(--gen-danger); }

    .toast-icon {
        font-size: 1rem;
    }

    .toast.success .toast-icon { color: var(--gen-success); }
    .toast.info .toast-icon { color: var(--gen-tertiary); }
    .toast.warning .toast-icon { color: var(--gen-warning); }
    .toast.error .toast-icon { color: var(--gen-danger); }

    /* FAB Button */
    .fab-container {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 100;
    }

    .fab-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    }

    .fab-btn.primary {
        background: linear-gradient(135deg, var(--gen-primary), var(--gen-secondary));
        color: white;
    }

    .fab-btn.secondary {
        background: rgba(255,255,255,0.1);
        color: var(--gen-text);
        border: 1px solid var(--gen-border);
    }

    .fab-btn:hover {
        transform: scale(1.1);
    }

    /* Responsive */
    @media (max-width: 1400px) {
        .gen-layout {
            grid-template-columns: 280px 1fr 320px;
        }
        .kpi-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 1100px) {
        .gen-layout {
            grid-template-columns: 1fr;
            height: auto;
        }
        .viewer-3d {
            min-height: 300px;
        }
        .kpi-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="gen-page">
    <!-- Header -->
    <div class="page-header-section">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fas fa-cubes"></i> Generative Design Studio</h1>
                <p>AI-Driven Topology Optimization for LEGO Manufacturing</p>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="connection-status">
                    <span class="connection-dot" id="connection-dot"></span>
                    <span id="connection-text">Connecting...</span>
                </div>
                <button class="btn btn-small btn-secondary" onclick="loadFromFusion360()">
                    <i class="fas fa-cloud-download-alt"></i> Import
                </button>
                <button class="btn btn-small btn-secondary" onclick="toggleCompareMode()">
                    <i class="fas fa-columns"></i> Compare
                </button>
                <button class="btn btn-small btn-secondary" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- KPI Grid -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-designs">47</div>
            <div class="kpi-label">Designs Generated</div>
            <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +12 this week</div>
        </div>
        <div class="kpi-card secondary">
            <div class="kpi-value" id="kpi-weight">32%</div>
            <div class="kpi-label">Avg Weight Reduction</div>
            <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +4.2%</div>
        </div>
        <div class="kpi-card success">
            <div class="kpi-value" id="kpi-compatibility">96%</div>
            <div class="kpi-label">LEGO Compatibility</div>
            <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +1.5%</div>
        </div>
        <div class="kpi-card tertiary">
            <div class="kpi-value" id="kpi-printability">94%</div>
            <div class="kpi-label">Printability Score</div>
            <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +2.1%</div>
        </div>
        <div class="kpi-card warning">
            <div class="kpi-value" id="kpi-active">3</div>
            <div class="kpi-label">Active Optimizations</div>
        </div>
        <div class="kpi-card danger">
            <div class="kpi-value" id="kpi-exported">28</div>
            <div class="kpi-label">Designs Exported</div>
            <div class="kpi-trend up"><i class="fas fa-arrow-up"></i> +8 this week</div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="gen-layout">
        <!-- Left Panel: Design Parameters -->
        <div class="panel">
            <div class="panel-tabs">
                <button class="panel-tab active" onclick="switchTab('params', this)">Parameters</button>
                <button class="panel-tab" onclick="switchTab('constraints', this)">Constraints</button>
                <button class="panel-tab" onclick="switchTab('advanced', this)">Advanced</button>
            </div>

            <!-- Parameters Tab -->
            <div class="tab-content" id="tab-params">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <i class="fas fa-sliders-h"></i>
                        <span>Design Space</span>
                    </div>
                    <span class="panel-badge">LEGO v6.0</span>
                </div>

                <div class="form-group">
                    <label>
                        Brick Type
                        <span class="label-hint">Standard LEGO dimensions</span>
                    </label>
                    <select id="brick-type" onchange="updateBrickPreview()">
                        <option value="2x2">Standard 2x2 Brick</option>
                        <option value="2x4" selected>Standard 2x4 Brick</option>
                        <option value="1x4">Standard 1x4 Brick</option>
                        <option value="2x6">Standard 2x6 Brick</option>
                        <option value="plate">2x4 Plate</option>
                        <option value="custom">Custom Design...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Design Space (mm)</label>
                    <div class="input-grid">
                        <input type="number" placeholder="X" value="31.8" id="dim-x">
                        <input type="number" placeholder="Y" value="15.8" id="dim-y">
                        <input type="number" placeholder="Z" value="9.6" id="dim-z">
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        Target Weight Reduction
                        <span class="label-hint">Material savings</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="10" max="60" value="30" id="weight-reduction"
                               oninput="updateRange('weight-reduction', 'weight-val', '%')">
                        <span class="range-value" id="weight-val">30%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        Minimum Safety Factor
                        <span class="label-hint">Structural margin</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="1.0" max="4.0" step="0.1" value="2.0" id="safety-factor"
                               oninput="updateRange('safety-factor', 'sf-val', 'x')">
                        <span class="range-value" id="sf-val">2.0x</span>
                    </div>
                </div>

                <div class="panel-header" style="margin-top: 16px;">
                    <div class="panel-header-left">
                        <i class="fas fa-layer-group"></i>
                        <span>Material</span>
                    </div>
                </div>

                <div class="material-grid">
                    <div class="material-card selected" onclick="selectMaterial(this, 'PLA')">
                        <div class="material-name">PLA</div>
                        <div class="material-props">45 MPa | 1.24 g/cmÂ³</div>
                        <span class="material-badge recommended">Recommended</span>
                    </div>
                    <div class="material-card" onclick="selectMaterial(this, 'ABS')">
                        <div class="material-name">ABS</div>
                        <div class="material-props">40 MPa | 1.04 g/cmÂ³</div>
                    </div>
                    <div class="material-card" onclick="selectMaterial(this, 'PETG')">
                        <div class="material-name">PETG</div>
                        <div class="material-props">50 MPa | 1.27 g/cmÂ³</div>
                    </div>
                    <div class="material-card" onclick="selectMaterial(this, 'Nylon')">
                        <div class="material-name">Nylon</div>
                        <div class="material-props">70 MPa | 1.15 g/cmÂ³</div>
                    </div>
                </div>

                <div class="panel-header" style="margin-top: 16px;">
                    <div class="panel-header-left">
                        <i class="fas fa-th"></i>
                        <span>Lattice Structure</span>
                    </div>
                </div>

                <div class="lattice-grid">
                    <div class="lattice-option selected" onclick="selectLattice(this, 'gyroid')">
                        <div class="lattice-icon">ðŸŒ€</div>
                        <div class="lattice-name">Gyroid</div>
                    </div>
                    <div class="lattice-option" onclick="selectLattice(this, 'honeycomb')">
                        <div class="lattice-icon">â¬¡</div>
                        <div class="lattice-name">Honeycomb</div>
                    </div>
                    <div class="lattice-option" onclick="selectLattice(this, 'octet')">
                        <div class="lattice-icon">â—‡</div>
                        <div class="lattice-name">Octet</div>
                    </div>
                    <div class="lattice-option" onclick="selectLattice(this, 'diamond')">
                        <div class="lattice-icon">ðŸ’Ž</div>
                        <div class="lattice-name">Diamond</div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 12px;">
                    <label>
                        Infill Density
                        <span class="label-hint">Internal structure</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="10" max="50" value="20" id="infill-density"
                               oninput="updateRange('infill-density', 'infill-val', '%')">
                        <span class="range-value" id="infill-val">20%</span>
                    </div>
                </div>
            </div>

            <!-- Constraints Tab -->
            <div class="tab-content" id="tab-constraints" style="display: none;">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <i class="fas fa-print"></i>
                        <span>Manufacturing Constraints</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Print Orientation</label>
                    <select id="orientation">
                        <option value="studs-up">Studs Up (Recommended)</option>
                        <option value="studs-down">Studs Down</option>
                        <option value="sideways">Sideways</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        Max Overhang Angle
                        <span class="label-hint">Support-free printing</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="30" max="60" value="45" id="overhang-angle"
                               oninput="updateRange('overhang-angle', 'overhang-val', 'Â°')">
                        <span class="range-value" id="overhang-val">45Â°</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        Minimum Wall Thickness
                        <span class="label-hint">Structural integrity</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="0.8" max="2.0" step="0.1" value="1.2" id="min-wall"
                               oninput="updateRange('min-wall', 'wall-val', 'mm')">
                        <span class="range-value" id="wall-val">1.2mm</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Active Constraints</label>
                    <div class="constraint-tags">
                        <span class="constraint-tag" onclick="toggleConstraint(this)">
                            <i class="fas fa-check"></i> LEGO Compatible
                        </span>
                        <span class="constraint-tag" onclick="toggleConstraint(this)">
                            <i class="fas fa-check"></i> Clutch Power
                        </span>
                        <span class="constraint-tag" onclick="toggleConstraint(this)">
                            <i class="fas fa-check"></i> No Supports
                        </span>
                        <span class="constraint-tag" onclick="toggleConstraint(this)">
                            <i class="fas fa-check"></i> Min Feature 0.4mm
                        </span>
                        <span class="constraint-tag" onclick="toggleConstraint(this)">
                            <i class="fas fa-check"></i> Bridging < 10mm
                        </span>
                    </div>
                </div>

                <div class="panel-header" style="margin-top: 16px;">
                    <div class="panel-header-left">
                        <i class="fas fa-ruler-combined"></i>
                        <span>LEGO Specifications</span>
                    </div>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-item">
                        <div class="analysis-value">4.8mm</div>
                        <div class="analysis-label">Stud Diameter</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-value">8.0mm</div>
                        <div class="analysis-label">Stud Pitch</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-value">1.7mm</div>
                        <div class="analysis-label">Stud Height</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-value">1.5-3N</div>
                        <div class="analysis-label">Clutch Force</div>
                    </div>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div class="tab-content" id="tab-advanced" style="display: none;">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <i class="fas fa-cogs"></i>
                        <span>Optimization Settings</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Algorithm</label>
                    <select id="algorithm">
                        <option value="simp">SIMP (Solid Isotropic Material)</option>
                        <option value="beso">BESO (Bi-directional ESO)</option>
                        <option value="level-set">Level Set Method</option>
                        <option value="genetic">Genetic Algorithm</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        Max Iterations
                        <span class="label-hint">Convergence limit</span>
                    </label>
                    <input type="number" value="200" id="max-iterations">
                </div>

                <div class="form-group">
                    <label>
                        Convergence Tolerance
                        <span class="label-hint">Stop criterion</span>
                    </label>
                    <input type="number" value="0.001" step="0.0001" id="tolerance">
                </div>

                <div class="form-group">
                    <label>
                        Mesh Resolution
                        <span class="label-hint">FEA element size</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="0.2" max="1.0" step="0.1" value="0.5" id="mesh-res"
                               oninput="updateRange('mesh-res', 'mesh-val', 'mm')">
                        <span class="range-value" id="mesh-val">0.5mm</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        Penalization Factor (p)
                        <span class="label-hint">SIMP exponent</span>
                    </label>
                    <div class="range-container">
                        <input type="range" min="1" max="5" step="0.5" value="3" id="penalization"
                               oninput="updateRange('penalization', 'pen-val', '')">
                        <span class="range-value" id="pen-val">3</span>
                    </div>
                </div>

                <div class="panel-header" style="margin-top: 16px;">
                    <div class="panel-header-left">
                        <i class="fas fa-balance-scale"></i>
                        <span>Multi-Objective Weights</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Strength Weight</label>
                    <div class="range-container">
                        <input type="range" min="0" max="100" value="40" id="weight-strength"
                               oninput="updateObjectiveWeights()">
                        <span class="range-value" id="strength-weight-val">40%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Printability Weight</label>
                    <div class="range-container">
                        <input type="range" min="0" max="100" value="30" id="weight-print"
                               oninput="updateObjectiveWeights()">
                        <span class="range-value" id="print-weight-val">30%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Material Weight</label>
                    <div class="range-container">
                        <input type="range" min="0" max="100" value="30" id="weight-material"
                               oninput="updateObjectiveWeights()">
                        <span class="range-value" id="material-weight-val">30%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center: 3D Viewer -->
        <div class="viewer-container">
            <div class="viewer-toolbar">
                <div class="viewer-title">
                    <i class="fas fa-cube"></i>
                    <span>3D Preview</span>
                    <span class="viewer-mode-badge" id="viewer-mode">Solid</span>
                </div>
                <div class="viewer-actions">
                    <button class="viewer-btn" id="btn-wireframe" onclick="toggleWireframe()" title="Wireframe">
                        <i class="fas fa-border-all"></i>
                    </button>
                    <button class="viewer-btn" id="btn-stress" onclick="toggleStress()" title="Stress Map">
                        <i class="fas fa-fire-alt"></i>
                    </button>
                    <button class="viewer-btn" id="btn-section" onclick="toggleSection()" title="Section View">
                        <i class="fas fa-cut"></i>
                    </button>
                    <button class="viewer-btn" id="btn-density" onclick="toggleDensity()" title="Density">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button class="viewer-btn" onclick="resetView()" title="Reset View">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="viewer-btn" onclick="fullscreenViewer()" title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>

            <div class="viewer-3d" id="viewer-3d">
                <div class="viewer-placeholder" id="viewer-placeholder">
                    <i class="fas fa-cube"></i>
                    <p>Click "Generate Design" to start optimization</p>
                    <p style="font-size: 0.8rem; margin-top: 8px;">Or import a design from Fusion 360</p>
                </div>
            </div>

            <div class="viewer-controls">
                <button class="control-btn"><i class="fas fa-search-plus"></i> Zoom</button>
                <button class="control-btn"><i class="fas fa-sync-alt"></i> Rotate</button>
                <button class="control-btn"><i class="fas fa-arrows-alt"></i> Pan</button>
                <button class="control-btn"><i class="fas fa-ruler-combined"></i> Measure</button>
                <button class="control-btn"><i class="fas fa-palette"></i> Color Map</button>
                <button class="control-btn"><i class="fas fa-camera"></i> Screenshot</button>
            </div>
        </div>

        <!-- Right Panel: Results & Actions -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-header-left">
                    <i class="fas fa-magic"></i>
                    <span>Optimization</span>
                </div>
            </div>

            <button class="btn btn-primary" id="btn-generate" onclick="startOptimization()">
                <i class="fas fa-play"></i> Generate Design
            </button>
            <button class="btn btn-secondary" id="btn-stop" onclick="stopOptimization()" style="display: none;">
                <i class="fas fa-stop"></i> Stop Optimization
            </button>

            <div class="optimization-status" id="opt-status">
                <div class="status-header">
                    <div class="status-label">
                        <span class="status-indicator" id="status-dot"></span>
                        <span id="status-text">Ready</span>
                    </div>
                    <span id="status-time" style="font-size: 0.8rem; color: var(--gen-text-muted);">--</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="opt-progress" style="width: 0%;"></div>
                </div>
                <div class="status-details">
                    <div class="detail-item">
                        <div class="detail-value" id="iteration">0</div>
                        <div class="detail-label">Iteration</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value" id="convergence">--</div>
                        <div class="detail-label">Convergence</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value" id="objective">--</div>
                        <div class="detail-label">Objective</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value" id="volume-frac">--</div>
                        <div class="detail-label">Vol. Frac.</div>
                    </div>
                </div>
            </div>

            <!-- Pareto Front Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <span class="chart-title"><i class="fas fa-chart-scatter"></i> Pareto Front</span>
                    <div class="chart-actions">
                        <button class="chart-btn active" onclick="setChartView('pareto')">2D</button>
                        <button class="chart-btn" onclick="setChartView('pareto3d')">3D</button>
                    </div>
                </div>
                <div id="pareto-chart" style="height: 180px;"></div>
            </div>

            <!-- Convergence Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <span class="chart-title"><i class="fas fa-chart-line"></i> Convergence</span>
                </div>
                <div id="convergence-chart" style="height: 140px;"></div>
            </div>

            <div class="panel-header">
                <div class="panel-header-left">
                    <i class="fas fa-chart-bar"></i>
                    <span>Fitness Evaluation</span>
                </div>
            </div>

            <div class="fitness-card">
                <div class="fitness-header">
                    <span class="fitness-name"><i class="fas fa-shield-alt" style="color: #f59e0b;"></i> Strength</span>
                    <span class="fitness-score" id="strength-score">--</span>
                </div>
                <div class="fitness-bar">
                    <div class="fitness-fill strength" id="strength-bar" style="width: 0%;"></div>
                </div>
            </div>

            <div class="fitness-card">
                <div class="fitness-header">
                    <span class="fitness-name"><i class="fas fa-print" style="color: #10b981;"></i> Printability</span>
                    <span class="fitness-score" id="print-score">--</span>
                </div>
                <div class="fitness-bar">
                    <div class="fitness-fill printability" id="print-bar" style="width: 0%;"></div>
                </div>
            </div>

            <div class="fitness-card">
                <div class="fitness-header">
                    <span class="fitness-name"><i class="fas fa-weight" style="color: #06b6d4;"></i> Material Usage</span>
                    <span class="fitness-score" id="material-score">--</span>
                </div>
                <div class="fitness-bar">
                    <div class="fitness-fill material" id="material-bar" style="width: 0%;"></div>
                </div>
            </div>

            <div class="fitness-card">
                <div class="fitness-header">
                    <span class="fitness-name"><i class="fas fa-puzzle-piece" style="color: #8b5cf6;"></i> LEGO Compatibility</span>
                    <span class="fitness-score" id="compat-score">--</span>
                </div>
                <div class="fitness-bar">
                    <div class="fitness-fill compatibility" id="compat-bar" style="width: 0%;"></div>
                </div>
            </div>

            <div class="analysis-grid">
                <div class="analysis-item">
                    <div class="analysis-value good" id="result-mass">--</div>
                    <div class="analysis-label">Mass (g)</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-value" id="result-stress">--</div>
                    <div class="analysis-label">Max Stress (MPa)</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-value" id="result-safety">--</div>
                    <div class="analysis-label">Safety Factor</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-value" id="result-reduction">--</div>
                    <div class="analysis-label">Weight Reduction</div>
                </div>
            </div>

            <!-- LEGO Validation -->
            <div class="validation-card" id="validation-card" style="display: none;">
                <div class="validation-header">
                    <i class="fas fa-certificate" style="color: var(--gen-success);"></i>
                    <strong>LEGO Validation</strong>
                    <span class="validation-badge pass" id="validation-badge">COMPATIBLE</span>
                </div>
                <div class="validation-checks" id="validation-checks">
                    <!-- Filled dynamically -->
                </div>
            </div>

            <div class="panel-header" style="margin-top: 14px;">
                <div class="panel-header-left">
                    <i class="fas fa-download"></i>
                    <span>Export</span>
                </div>
            </div>

            <button class="btn btn-success" id="export-fusion" disabled onclick="openExportPanel()">
                <i class="fas fa-cloud-upload-alt"></i> Export Design
            </button>

            <div class="panel-header" style="margin-top: 14px;">
                <div class="panel-header-left">
                    <i class="fas fa-images"></i>
                    <span>Design Gallery</span>
                </div>
            </div>

            <div class="design-gallery" id="design-gallery">
                <div class="gallery-item selected" onclick="selectGalleryItem(this, 0)">
                    <i class="fas fa-cube"></i>
                    <span class="gallery-score">0.92</span>
                    <span class="gallery-label">Gyroid 20%</span>
                </div>
                <div class="gallery-item" onclick="selectGalleryItem(this, 1)">
                    <i class="fas fa-cube"></i>
                    <span class="gallery-score">0.89</span>
                    <span class="gallery-label">Honeycomb</span>
                </div>
                <div class="gallery-item" onclick="selectGalleryItem(this, 2)">
                    <i class="fas fa-cube"></i>
                    <span class="gallery-score">0.85</span>
                    <span class="gallery-label">Octet</span>
                </div>
            </div>

            <div class="panel-header" style="margin-top: 14px;">
                <div class="panel-header-left">
                    <i class="fas fa-history"></i>
                    <span>Recent Designs</span>
                </div>
            </div>

            <div class="history-list" id="history-list">
                <div class="history-item" onclick="loadDesign('h1')">
                    <div class="history-thumb"><i class="fas fa-cube"></i></div>
                    <div class="history-info">
                        <div class="history-name">2x4 Brick - Gyroid 20%</div>
                        <div class="history-meta">Today 14:32</div>
                    </div>
                    <span class="history-score">0.92</span>
                </div>
                <div class="history-item" onclick="loadDesign('h2')">
                    <div class="history-thumb"><i class="fas fa-cube"></i></div>
                    <div class="history-info">
                        <div class="history-name">2x2 Brick - Honeycomb 15%</div>
                        <div class="history-meta">Today 11:15</div>
                    </div>
                    <span class="history-score">0.89</span>
                </div>
                <div class="history-item" onclick="loadDesign('h3')">
                    <div class="history-thumb"><i class="fas fa-cube"></i></div>
                    <div class="history-info">
                        <div class="history-name">Custom 4x4 Plate</div>
                        <div class="history-meta">Yesterday</div>
                    </div>
                    <span class="history-score">0.85</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Panel -->
<div class="export-panel" id="export-panel">
    <button class="export-close" onclick="closeExportPanel()"><i class="fas fa-times"></i></button>
    <h3 style="margin-bottom: 20px;"><i class="fas fa-download" style="color: var(--gen-primary);"></i> Export Design</h3>

    <div class="form-group">
        <label>Design Name</label>
        <input type="text" value="2x4_Brick_Gyroid_v1" id="export-name">
    </div>

    <div class="panel-header" style="margin-top: 20px;">
        <div class="panel-header-left">
            <i class="fas fa-file-export"></i>
            <span>Export Format</span>
        </div>
    </div>

    <div class="export-format-grid">
        <div class="export-format selected" onclick="selectExportFormat(this, 'fusion')">
            <i class="fab fa-autodesk"></i>
            <div class="export-format-name">Fusion 360</div>
            <div class="export-format-desc">Direct CAD import</div>
        </div>
        <div class="export-format" onclick="selectExportFormat(this, 'stl')">
            <i class="fas fa-cube"></i>
            <div class="export-format-name">STL</div>
            <div class="export-format-desc">3D printing</div>
        </div>
        <div class="export-format" onclick="selectExportFormat(this, 'step')">
            <i class="fas fa-drafting-compass"></i>
            <div class="export-format-name">STEP</div>
            <div class="export-format-desc">CAD exchange</div>
        </div>
        <div class="export-format" onclick="selectExportFormat(this, 'gcode')">
            <i class="fas fa-print"></i>
            <div class="export-format-name">G-Code</div>
            <div class="export-format-desc">Ready to print</div>
        </div>
    </div>

    <div class="form-group" id="gcode-settings" style="display: none;">
        <label>Printer Profile</label>
        <select id="printer-profile">
            <option value="prusa">Prusa MK4</option>
            <option value="bambu">Bambu Lab A1</option>
            <option value="ender">Ender 3 V3</option>
            <option value="custom">Custom...</option>
        </select>
    </div>

    <div class="form-group" style="margin-top: 20px;">
        <label>Include</label>
        <div class="constraint-tags">
            <span class="constraint-tag"><i class="fas fa-check"></i> Design Report</span>
            <span class="constraint-tag"><i class="fas fa-check"></i> FEA Results</span>
            <span class="constraint-tag"><i class="fas fa-check"></i> Validation Data</span>
        </div>
    </div>

    <button class="btn btn-primary" style="margin-top: 20px;" onclick="executeExport()">
        <i class="fas fa-cloud-upload-alt"></i> Export Now
    </button>
</div>

<!-- Settings Modal -->
<div class="settings-overlay" id="settings-overlay">
    <div class="settings-modal">
        <div class="settings-header">
            <h3><i class="fas fa-cog" style="color: var(--gen-primary);"></i> Settings</h3>
            <button class="export-close" onclick="closeSettings()"><i class="fas fa-times"></i></button>
        </div>

        <div class="settings-section">
            <div class="settings-section-title">Display</div>
            <div class="form-group">
                <label>Theme</label>
                <select id="theme-select">
                    <option value="dark">Dark (Default)</option>
                    <option value="light">Light</option>
                    <option value="auto">System</option>
                </select>
            </div>
            <div class="form-group">
                <label>3D Render Quality</label>
                <select id="render-quality">
                    <option value="low">Low (Fast)</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High (GPU Required)</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-section-title">Optimization Defaults</div>
            <div class="form-group">
                <label>Default Algorithm</label>
                <select id="default-algorithm">
                    <option value="simp" selected>SIMP</option>
                    <option value="beso">BESO</option>
                    <option value="genetic">Genetic</option>
                </select>
            </div>
            <div class="form-group">
                <label>Auto-save Interval</label>
                <select id="autosave-interval">
                    <option value="0">Disabled</option>
                    <option value="30">30 seconds</option>
                    <option value="60" selected>1 minute</option>
                    <option value="300">5 minutes</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-section-title">Fusion 360 Integration</div>
            <div class="form-group">
                <label>Connection Status</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="connection-dot connected"></span>
                    <span>Connected</span>
                    <button class="btn btn-small btn-secondary" onclick="reconnectFusion()">Reconnect</button>
                </div>
            </div>
        </div>

        <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save"></i> Save Settings
        </button>
    </div>
</div>

<!-- FAB Buttons -->
<div class="fab-container">
    <button class="fab-btn secondary" onclick="showHelp()" title="Help">
        <i class="fas fa-question"></i>
    </button>
    <button class="fab-btn primary" onclick="quickGenerate()" title="Quick Generate">
        <i class="fas fa-bolt"></i>
    </button>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script>
// Global state
let optimizationInterval = null;
let currentLattice = 'gyroid';
let currentMaterial = 'PLA';
let selectedExportFormat = 'fusion';
let socket = null;
let isCompareMode = false;
let convergenceHistory = [];
let paretoSolutions = [];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    initWebSocket();
    initCharts();
    showToast('Generative Design Studio ready', 'success');
});

// WebSocket
function initWebSocket() {
    const dot = document.getElementById('connection-dot');
    const text = document.getElementById('connection-text');

    if (typeof io !== 'undefined') {
        dot.classList.add('connecting');
        text.textContent = 'Connecting...';

        socket = io();

        socket.on('connect', () => {
            dot.classList.remove('connecting');
            dot.classList.add('connected');
            text.textContent = 'Connected';
            console.log('Connected to Generative Design WebSocket');
        });

        socket.on('disconnect', () => {
            dot.classList.remove('connected');
            text.textContent = 'Disconnected';
        });

        socket.on('optimization_update', (data) => {
            updateOptimizationProgress(data);
        });

        socket.on('design_generated', (data) => {
            handleDesignGenerated(data);
        });
    } else {
        // Simulate connected for demo
        setTimeout(() => {
            dot.classList.add('connected');
            text.textContent = 'Connected';
        }, 1000);
    }
}

// Initialize Plotly charts
function initCharts() {
    // Pareto Front Chart
    const paretoLayout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0.2)',
        margin: { t: 10, r: 10, b: 40, l: 50 },
        xaxis: {
            title: { text: 'Weight Reduction (%)', font: { size: 10, color: '#888' } },
            gridcolor: 'rgba(255,255,255,0.05)',
            tickfont: { size: 9, color: '#888' }
        },
        yaxis: {
            title: { text: 'Strength Score', font: { size: 10, color: '#888' } },
            gridcolor: 'rgba(255,255,255,0.05)',
            tickfont: { size: 9, color: '#888' }
        },
        showlegend: false
    };

    Plotly.newPlot('pareto-chart', [{
        x: [],
        y: [],
        mode: 'markers',
        type: 'scatter',
        marker: {
            color: [],
            colorscale: [[0, '#ec4899'], [1, '#8b5cf6']],
            size: 10,
            line: { color: 'white', width: 1 }
        }
    }], paretoLayout, { displayModeBar: false, responsive: true });

    // Convergence Chart
    const convergenceLayout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0.2)',
        margin: { t: 10, r: 10, b: 30, l: 50 },
        xaxis: {
            title: { text: 'Iteration', font: { size: 10, color: '#888' } },
            gridcolor: 'rgba(255,255,255,0.05)',
            tickfont: { size: 9, color: '#888' }
        },
        yaxis: {
            title: { text: 'Objective', font: { size: 10, color: '#888' } },
            gridcolor: 'rgba(255,255,255,0.05)',
            tickfont: { size: 9, color: '#888' }
        },
        showlegend: false
    };

    Plotly.newPlot('convergence-chart', [{
        x: [],
        y: [],
        mode: 'lines',
        type: 'scatter',
        line: { color: '#ec4899', width: 2 },
        fill: 'tozeroy',
        fillcolor: 'rgba(236, 72, 153, 0.1)'
    }], convergenceLayout, { displayModeBar: false, responsive: true });
}

// Tab switching
function switchTab(tabId, btn) {
    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
    btn.classList.add('active');
    document.getElementById('tab-' + tabId).style.display = 'block';
}

// Range sliders
function updateRange(inputId, displayId, suffix) {
    const input = document.getElementById(inputId);
    const display = document.getElementById(displayId);
    display.textContent = input.value + suffix;
}

// Material selection
function selectMaterial(element, material) {
    document.querySelectorAll('.material-card').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    currentMaterial = material;
    showToast(`Material: ${material}`, 'info');
}

// Lattice selection
function selectLattice(element, type) {
    document.querySelectorAll('.lattice-option').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    currentLattice = type;
    showToast(`Lattice type: ${type}`, 'info');
}

// Constraint toggling
function toggleConstraint(element) {
    element.classList.toggle('disabled');
    const icon = element.querySelector('i');
    if (element.classList.contains('disabled')) {
        icon.classList.remove('fa-check');
        icon.classList.add('fa-times');
    } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-check');
    }
}

// Update objective weights
function updateObjectiveWeights() {
    const strength = document.getElementById('weight-strength').value;
    const print = document.getElementById('weight-print').value;
    const material = document.getElementById('weight-material').value;

    document.getElementById('strength-weight-val').textContent = strength + '%';
    document.getElementById('print-weight-val').textContent = print + '%';
    document.getElementById('material-weight-val').textContent = material + '%';
}

// Optimization
function startOptimization() {
    const status = document.getElementById('opt-status');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const btnGenerate = document.getElementById('btn-generate');
    const btnStop = document.getElementById('btn-stop');

    status.classList.add('running');
    statusDot.classList.add('running');
    statusText.textContent = 'Optimizing...';
    btnGenerate.style.display = 'none';
    btnStop.style.display = 'flex';

    // Reset charts
    convergenceHistory = [];
    paretoSolutions = [];

    showToast('Starting topology optimization...', 'info');

    let progress = 0;
    let startTime = Date.now();
    let iterationCount = 0;

    optimizationInterval = setInterval(() => {
        iterationCount++;
        // Deterministic progress: starts fast, slows down (simulates convergence)
        const progressStep = 2.5 * Math.exp(-iterationCount * 0.02);
        progress += Math.max(0.3, progressStep);
        if (progress > 100) progress = 100;

        const iteration = Math.floor(progress * 2);
        // Objective function with sinusoidal micro-variation (deterministic)
        const objectiveNoise = Math.sin(iteration * 0.3) * 0.01;
        const objective = Math.max(0.2, 0.5 - progress * 0.003 + objectiveNoise);
        const volumeFrac = Math.max(0.3, 0.7 - progress * 0.004);

        document.getElementById('opt-progress').style.width = progress + '%';
        document.getElementById('iteration').textContent = iteration;
        document.getElementById('convergence').textContent = (0.1 - progress * 0.0009).toFixed(4);
        document.getElementById('objective').textContent = objective.toFixed(3);
        document.getElementById('volume-frac').textContent = volumeFrac.toFixed(2);

        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('status-time').textContent = formatTime(elapsed);

        // Update convergence chart
        convergenceHistory.push({ x: iteration, y: objective });
        updateConvergenceChart();

        // Add pareto solution every 10 iterations (deterministic placement)
        if (iteration % 10 === 0) {
            const paretoIndex = Math.floor(iteration / 10);
            paretoSolutions.push({
                x: 20 + (paretoIndex * 7) % 30,  // Spread across x-axis
                y: 70 + Math.sin(paretoIndex * 0.8) * 12.5 + 12.5,  // Sinusoidal y
                score: 0.7 + (paretoIndex % 5) * 0.05  // Deterministic score
            });
            updateParetoChart();
        }

        updateFitnessScores(progress);

        if (progress >= 100) {
            completeOptimization();
        }
    }, 100);
}

function updateConvergenceChart() {
    Plotly.update('convergence-chart', {
        x: [convergenceHistory.map(p => p.x)],
        y: [convergenceHistory.map(p => p.y)]
    });
}

function updateParetoChart() {
    Plotly.update('pareto-chart', {
        x: [paretoSolutions.map(p => p.x)],
        y: [paretoSolutions.map(p => p.y)],
        'marker.color': [paretoSolutions.map(p => p.score)]
    });
}

function completeOptimization() {
    clearInterval(optimizationInterval);

    const status = document.getElementById('opt-status');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const btnGenerate = document.getElementById('btn-generate');
    const btnStop = document.getElementById('btn-stop');

    status.classList.remove('running');
    status.classList.add('complete');
    statusDot.classList.remove('running');
    statusDot.classList.add('complete');
    statusText.textContent = 'Complete!';
    btnGenerate.style.display = 'flex';
    btnStop.style.display = 'none';

    // Show results
    document.getElementById('result-mass').textContent = '2.52';
    document.getElementById('result-stress').textContent = '25.3';
    document.getElementById('result-safety').textContent = '1.82x';
    document.getElementById('result-reduction').textContent = '42%';

    // Enable export
    document.getElementById('export-fusion').disabled = false;

    // Show validation
    showValidation();

    // Update viewer
    document.getElementById('viewer-3d').innerHTML = `
        <div style="text-align: center;">
            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--gen-success); margin-bottom: 15px;"></i>
            <p style="color: #fff; font-size: 1.1rem; font-weight: 600;">Optimization Complete!</p>
            <p style="color: #888; font-size: 0.9rem;">Weight reduced by 42% with 1.82x safety factor</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                <button class="control-btn" onclick="viewModel()">
                    <i class="fas fa-cube"></i> View 3D Model
                </button>
                <button class="control-btn" onclick="viewStressMap()">
                    <i class="fas fa-fire-alt"></i> Stress Map
                </button>
            </div>
        </div>
    `;

    showToast('Optimization complete! Design is LEGO-compatible.', 'success');
}

function stopOptimization() {
    clearInterval(optimizationInterval);

    const status = document.getElementById('opt-status');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const btnGenerate = document.getElementById('btn-generate');
    const btnStop = document.getElementById('btn-stop');

    status.classList.remove('running');
    statusDot.classList.remove('running');
    statusText.textContent = 'Stopped';
    btnGenerate.style.display = 'flex';
    btnStop.style.display = 'none';

    showToast('Optimization stopped', 'warning');
}

function updateFitnessScores(progress) {
    const strength = Math.min(92, 55 + progress * 0.37);
    const print = Math.min(94, 50 + progress * 0.44);
    const material = Math.min(88, 40 + progress * 0.48);
    const compat = Math.min(96, 65 + progress * 0.31);

    document.getElementById('strength-score').textContent = strength.toFixed(0) + '%';
    document.getElementById('strength-bar').style.width = strength + '%';

    document.getElementById('print-score').textContent = print.toFixed(0) + '%';
    document.getElementById('print-bar').style.width = print + '%';

    document.getElementById('material-score').textContent = material.toFixed(0) + '%';
    document.getElementById('material-bar').style.width = material + '%';

    document.getElementById('compat-score').textContent = compat.toFixed(0) + '%';
    document.getElementById('compat-bar').style.width = compat + '%';
}

function showValidation() {
    const card = document.getElementById('validation-card');
    const checks = document.getElementById('validation-checks');

    card.style.display = 'block';

    checks.innerHTML = `
        <div class="check-item">
            <span>Stud Diameter</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
        <div class="check-item">
            <span>Stud Pitch</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
        <div class="check-item">
            <span>Clutch Force</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
        <div class="check-item">
            <span>Wall Thickness</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
        <div class="check-item">
            <span>Overhang Angle</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
        <div class="check-item">
            <span>Min Feature</span>
            <i class="fas fa-check-circle pass"></i>
        </div>
    `;
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Viewer functions
function toggleWireframe() {
    const btn = document.getElementById('btn-wireframe');
    btn.classList.toggle('active');
    updateViewerMode();
    showToast('Wireframe ' + (btn.classList.contains('active') ? 'enabled' : 'disabled'), 'info');
}

function toggleStress() {
    const btn = document.getElementById('btn-stress');
    btn.classList.toggle('active');
    updateViewerMode();
    showToast('Stress visualization ' + (btn.classList.contains('active') ? 'enabled' : 'disabled'), 'info');
}

function toggleSection() {
    const btn = document.getElementById('btn-section');
    btn.classList.toggle('active');
    showToast('Section view ' + (btn.classList.contains('active') ? 'enabled' : 'disabled'), 'info');
}

function toggleDensity() {
    const btn = document.getElementById('btn-density');
    btn.classList.toggle('active');
    showToast('Density view ' + (btn.classList.contains('active') ? 'enabled' : 'disabled'), 'info');
}

function updateViewerMode() {
    const mode = document.getElementById('viewer-mode');
    const wireframe = document.getElementById('btn-wireframe').classList.contains('active');
    const stress = document.getElementById('btn-stress').classList.contains('active');

    if (stress) mode.textContent = 'Stress';
    else if (wireframe) mode.textContent = 'Wireframe';
    else mode.textContent = 'Solid';
}

function resetView() {
    showToast('View reset to default', 'info');
}

function fullscreenViewer() {
    const viewer = document.querySelector('.viewer-container');
    if (viewer.requestFullscreen) {
        viewer.requestFullscreen();
    }
}

function viewModel() {
    showToast('Loading 3D model...', 'info');
}

function viewStressMap() {
    const btn = document.getElementById('btn-stress');
    if (!btn.classList.contains('active')) {
        btn.classList.add('active');
        updateViewerMode();
    }
    showToast('Loading stress map...', 'info');
}

// Gallery functions
function selectGalleryItem(element, index) {
    document.querySelectorAll('.gallery-item').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    showToast(`Selected design variant ${index + 1}`, 'info');
}

// Export functions
function openExportPanel() {
    document.getElementById('export-panel').classList.add('active');
}

function closeExportPanel() {
    document.getElementById('export-panel').classList.remove('active');
}

function selectExportFormat(element, format) {
    document.querySelectorAll('.export-format').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    selectedExportFormat = format;

    // Show G-code settings if G-code selected
    document.getElementById('gcode-settings').style.display = format === 'gcode' ? 'block' : 'none';
}

function executeExport() {
    const name = document.getElementById('export-name').value;
    showToast(`Exporting "${name}" as ${selectedExportFormat.toUpperCase()}...`, 'info');

    setTimeout(() => {
        closeExportPanel();
        showToast('Export complete!', 'success');
    }, 2000);
}

// Settings
function showSettings() {
    document.getElementById('settings-overlay').classList.add('active');
}

function closeSettings() {
    document.getElementById('settings-overlay').classList.remove('active');
}

function saveSettings() {
    closeSettings();
    showToast('Settings saved', 'success');
}

function reconnectFusion() {
    showToast('Reconnecting to Fusion 360...', 'info');
}

// Compare mode
function toggleCompareMode() {
    isCompareMode = !isCompareMode;
    showToast('Compare mode ' + (isCompareMode ? 'enabled' : 'disabled'), 'info');
}

// Other functions
function loadFromFusion360() {
    showToast('Connecting to Fusion 360...', 'info');
}

function updateBrickPreview() {
    const type = document.getElementById('brick-type').value;

    // Update dimensions based on brick type
    const dimensions = {
        '2x2': { x: 15.8, y: 15.8, z: 9.6 },
        '2x4': { x: 31.8, y: 15.8, z: 9.6 },
        '1x4': { x: 31.8, y: 7.8, z: 9.6 },
        '2x6': { x: 47.8, y: 15.8, z: 9.6 },
        'plate': { x: 31.8, y: 15.8, z: 3.2 },
        'custom': { x: 31.8, y: 15.8, z: 9.6 }
    };

    const dims = dimensions[type];
    document.getElementById('dim-x').value = dims.x;
    document.getElementById('dim-y').value = dims.y;
    document.getElementById('dim-z').value = dims.z;

    showToast(`Selected: ${type}`, 'info');
}

function loadDesign(id) {
    showToast(`Loading design ${id}...`, 'info');
}

function setChartView(view) {
    document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    showToast(`Chart view: ${view}`, 'info');
}

function quickGenerate() {
    showToast('Quick generate with default settings...', 'info');
    startOptimization();
}

function showHelp() {
    showToast('Help documentation opening...', 'info');
}

// Toast notifications
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;

    const icon = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    }[type];

    toast.innerHTML = `
        <i class="fas ${icon} toast-icon"></i>
        <span>${message}</span>
    `;

    container.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}
</script>
{% endblock %}
