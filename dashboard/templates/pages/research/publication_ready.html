{% extends "base.html" %}

{% block title %}Publication-Ready Export - Research Platform{% endblock %}

{% block head %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
    :root {
        --pub-primary: #10b981;
        --pub-secondary: #8b5cf6;
        --pub-accent: #f59e0b;
        --pub-success: #10b981;
        --pub-warning: #f59e0b;
        --pub-danger: #ef4444;
        --pub-info: #3b82f6;
        --pub-dark: #0f172a;
        --pub-darker: #020617;
        --pub-card: #1e293b;
        --pub-border: #334155;
        --pub-text: #f1f5f9;
        --pub-text-muted: #94a3b8;
        --pub-latex: #1e1e1e;
        --pub-latex-cmd: #569cd6;
        --pub-latex-bracket: #ffd700;
        --pub-latex-string: #ce9178;
        --pub-latex-comment: #6a9955;
        --pub-ieee: #00629b;
        --pub-acm: #0085ca;
        --pub-springer: #004b83;
        --pub-elsevier: #ff6c00;
        --pub-nature: #d51920;
        --pub-arxiv: #b31b1b;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, var(--pub-darker) 0%, var(--pub-dark) 100%);
        color: var(--pub-text);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        min-height: 100vh;
    }

    .pub-container {
        padding: 1.5rem;
        max-width: 1600px;
        margin: 0 auto;
    }

    /* Header */
    .pub-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .pub-title-section h1 {
        font-size: 1.75rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--pub-primary), var(--pub-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .pub-title-section p {
        color: var(--pub-text-muted);
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }

    .pub-header-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
    }

    .pub-connection-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--pub-card);
        border-radius: 9999px;
        font-size: 0.75rem;
    }

    .pub-status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--pub-danger);
        animation: pulse 2s infinite;
    }

    .pub-status-dot.connected {
        background: var(--pub-success);
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* KPI Cards */
    .pub-kpi-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 1200px) {
        .pub-kpi-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 768px) {
        .pub-kpi-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .pub-kpi-card {
        background: var(--pub-card);
        border-radius: 12px;
        padding: 1.25rem;
        position: relative;
        overflow: hidden;
        border: 1px solid var(--pub-border);
        transition: all 0.3s;
    }

    .pub-kpi-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .pub-kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
    }

    .pub-kpi-card.figures::before { background: linear-gradient(90deg, var(--pub-primary), #34d399); }
    .pub-kpi-card.tables::before { background: linear-gradient(90deg, var(--pub-secondary), #a78bfa); }
    .pub-kpi-card.exports::before { background: linear-gradient(90deg, var(--pub-info), #60a5fa); }
    .pub-kpi-card.quality::before { background: linear-gradient(90deg, var(--pub-warning), #fbbf24); }
    .pub-kpi-card.venue::before { background: linear-gradient(90deg, var(--pub-ieee), #3b82f6); }

    .pub-kpi-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }

    .pub-kpi-label {
        font-size: 0.75rem;
        color: var(--pub-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .pub-kpi-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        background: rgba(16, 185, 129, 0.2);
        color: var(--pub-primary);
    }

    .pub-kpi-value {
        font-size: 1.5rem;
        font-weight: 700;
    }

    .pub-kpi-meta {
        font-size: 0.75rem;
        color: var(--pub-text-muted);
        margin-top: 0.25rem;
    }

    /* Venue Selector */
    .pub-venue-section {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--pub-border);
    }

    .pub-venue-section h3 {
        font-size: 1rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-venue-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 0.75rem;
    }

    @media (max-width: 1000px) {
        .pub-venue-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 600px) {
        .pub-venue-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .pub-venue-card {
        background: var(--pub-dark);
        border: 2px solid var(--pub-border);
        border-radius: 12px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
    }

    .pub-venue-card:hover {
        border-color: var(--pub-primary);
    }

    .pub-venue-card.selected {
        border-color: var(--pub-primary);
        background: rgba(16, 185, 129, 0.1);
    }

    .pub-venue-logo {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .pub-venue-card[data-venue="ieee"] .pub-venue-logo { color: var(--pub-ieee); }
    .pub-venue-card[data-venue="acm"] .pub-venue-logo { color: var(--pub-acm); }
    .pub-venue-card[data-venue="springer"] .pub-venue-logo { color: var(--pub-springer); }
    .pub-venue-card[data-venue="elsevier"] .pub-venue-logo { color: var(--pub-elsevier); }
    .pub-venue-card[data-venue="nature"] .pub-venue-logo { color: var(--pub-nature); }
    .pub-venue-card[data-venue="arxiv"] .pub-venue-logo { color: var(--pub-arxiv); }

    .pub-venue-name {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .pub-venue-specs {
        font-size: 0.7rem;
        color: var(--pub-text-muted);
    }

    /* Main Grid */
    .pub-main-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 1200px) {
        .pub-main-grid { grid-template-columns: 1fr; }
    }

    /* Export Types */
    .pub-export-types {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 900px) {
        .pub-export-types { grid-template-columns: repeat(2, 1fr); }
    }

    .pub-export-card {
        background: var(--pub-card);
        border: 2px solid var(--pub-border);
        border-radius: 12px;
        padding: 1.25rem;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
    }

    .pub-export-card:hover {
        transform: translateY(-2px);
    }

    .pub-export-card.selected {
        border-color: var(--pub-primary);
        background: rgba(16, 185, 129, 0.1);
    }

    .pub-export-icon {
        font-size: 2rem;
        margin-bottom: 0.75rem;
    }

    .pub-export-card h4 {
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }

    .pub-export-card p {
        font-size: 0.75rem;
        color: var(--pub-text-muted);
    }

    .pub-export-count {
        display: inline-block;
        background: var(--pub-primary);
        color: white;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.7rem;
        font-weight: 600;
        margin-top: 0.5rem;
    }

    /* Figure Gallery */
    .pub-figure-gallery {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--pub-border);
    }

    .pub-gallery-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .pub-gallery-header h3 {
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-gallery-actions {
        display: flex;
        gap: 0.5rem;
    }

    .pub-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.375rem;
        transition: all 0.2s;
    }

    .pub-btn-primary {
        background: linear-gradient(135deg, var(--pub-primary), #059669);
        color: white;
    }

    .pub-btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .pub-btn-secondary {
        background: var(--pub-dark);
        color: var(--pub-text);
        border: 1px solid var(--pub-border);
    }

    .pub-btn-secondary:hover {
        background: var(--pub-border);
    }

    .pub-gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem;
    }

    .pub-figure-item {
        background: var(--pub-dark);
        border: 2px solid var(--pub-border);
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.2s;
    }

    .pub-figure-item:hover {
        border-color: var(--pub-primary);
        transform: translateY(-2px);
    }

    .pub-figure-item.selected {
        border-color: var(--pub-primary);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }

    .pub-figure-preview {
        height: 120px;
        position: relative;
        overflow: hidden;
    }

    .pub-figure-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .pub-figure-item:hover .pub-figure-overlay {
        opacity: 1;
    }

    .pub-figure-info {
        padding: 0.75rem;
    }

    .pub-figure-name {
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    .pub-figure-name .check {
        color: var(--pub-primary);
    }

    .pub-figure-type {
        font-size: 0.7rem;
        color: var(--pub-text-muted);
    }

    /* Settings Panel */
    .pub-settings-panel {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--pub-border);
    }

    .pub-settings-panel h3 {
        font-size: 1rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-settings-group {
        margin-bottom: 1rem;
    }

    .pub-settings-group:last-child {
        margin-bottom: 0;
    }

    .pub-settings-label {
        font-size: 0.75rem;
        color: var(--pub-text-muted);
        margin-bottom: 0.375rem;
        display: block;
    }

    .pub-select {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--pub-border);
        background: var(--pub-dark);
        color: var(--pub-text);
        font-size: 0.875rem;
        cursor: pointer;
    }

    .pub-select:focus {
        outline: none;
        border-color: var(--pub-primary);
    }

    /* LaTeX Preview */
    .pub-latex-section {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--pub-border);
        grid-column: span 2;
    }

    @media (max-width: 1200px) {
        .pub-latex-section { grid-column: span 1; }
    }

    .pub-latex-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .pub-latex-header h3 {
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-latex-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--pub-border);
        padding-bottom: 0.75rem;
    }

    .pub-latex-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: none;
        color: var(--pub-text-muted);
        cursor: pointer;
        font-size: 0.875rem;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s;
    }

    .pub-latex-tab:hover {
        color: var(--pub-text);
    }

    .pub-latex-tab.active {
        background: var(--pub-primary);
        color: white;
    }

    .pub-latex-code {
        background: var(--pub-latex);
        border-radius: 8px;
        padding: 1rem;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.8rem;
        overflow-x: auto;
        line-height: 1.6;
        max-height: 400px;
        overflow-y: auto;
    }

    .pub-latex-code .cmd { color: var(--pub-latex-cmd); }
    .pub-latex-code .brk { color: var(--pub-latex-bracket); }
    .pub-latex-code .str { color: var(--pub-latex-string); }
    .pub-latex-code .cmt { color: var(--pub-latex-comment); font-style: italic; }

    .pub-latex-code .line-num {
        display: inline-block;
        width: 30px;
        color: #6b7280;
        user-select: none;
    }

    /* Checklist */
    .pub-checklist-section {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--pub-border);
    }

    .pub-checklist-section h3 {
        font-size: 1rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-checklist {
        list-style: none;
    }

    .pub-checklist-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.625rem 0;
        border-bottom: 1px solid var(--pub-border);
    }

    .pub-checklist-item:last-child {
        border-bottom: none;
    }

    .pub-checkbox {
        width: 20px;
        height: 20px;
        border-radius: 6px;
        border: 2px solid var(--pub-border);
        cursor: pointer;
        appearance: none;
        transition: all 0.2s;
    }

    .pub-checkbox:checked {
        background: var(--pub-primary);
        border-color: var(--pub-primary);
    }

    .pub-checkbox:checked::after {
        content: 'âœ“';
        display: block;
        text-align: center;
        color: white;
        font-size: 0.75rem;
        line-height: 16px;
    }

    .pub-checklist-label {
        font-size: 0.875rem;
        flex: 1;
    }

    .pub-checklist-badge {
        padding: 0.125rem 0.5rem;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .pub-checklist-badge.pass {
        background: rgba(16, 185, 129, 0.2);
        color: var(--pub-success);
    }

    .pub-checklist-badge.warn {
        background: rgba(245, 158, 11, 0.2);
        color: var(--pub-warning);
    }

    /* Export Progress */
    .pub-export-progress {
        background: var(--pub-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--pub-border);
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 350px;
        display: none;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        z-index: 100;
    }

    .pub-export-progress.active {
        display: block;
    }

    .pub-progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .pub-progress-header h4 {
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pub-progress-bar {
        height: 6px;
        background: var(--pub-dark);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 0.75rem;
    }

    .pub-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--pub-primary), #34d399);
        border-radius: 3px;
        width: 0%;
        transition: width 0.3s;
    }

    .pub-progress-status {
        font-size: 0.8rem;
        color: var(--pub-text-muted);
    }

    .pub-progress-files {
        margin-top: 0.75rem;
        max-height: 150px;
        overflow-y: auto;
    }

    .pub-progress-file {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.375rem 0;
        font-size: 0.75rem;
    }

    .pub-progress-file.done { color: var(--pub-success); }
    .pub-progress-file.pending { color: var(--pub-text-muted); }

    /* Toast Notifications */
    .pub-toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .pub-toast {
        background: var(--pub-card);
        border: 1px solid var(--pub-border);
        border-radius: 10px;
        padding: 1rem 1.25rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        animation: slideIn 0.3s ease;
        min-width: 300px;
    }

    .pub-toast.success { border-left: 4px solid var(--pub-success); }
    .pub-toast.error { border-left: 4px solid var(--pub-danger); }
    .pub-toast.info { border-left: 4px solid var(--pub-info); }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .pub-toast-icon {
        font-size: 1.25rem;
    }

    .pub-toast.success .pub-toast-icon { color: var(--pub-success); }
    .pub-toast.error .pub-toast-icon { color: var(--pub-danger); }
    .pub-toast.info .pub-toast-icon { color: var(--pub-info); }

    .pub-toast-content {
        flex: 1;
    }

    .pub-toast-title {
        font-weight: 600;
        margin-bottom: 0.125rem;
    }

    .pub-toast-message {
        font-size: 0.8rem;
        color: var(--pub-text-muted);
    }

    .pub-toast-close {
        background: none;
        border: none;
        color: var(--pub-text-muted);
        cursor: pointer;
    }

    /* FAB Button */
    .pub-fab {
        position: fixed;
        bottom: 1.5rem;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, var(--pub-primary), #059669);
        color: white;
        border: none;
        border-radius: 9999px;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);
        transition: all 0.2s;
        z-index: 50;
    }

    .pub-fab:hover {
        transform: translateX(-50%) translateY(-2px);
        box-shadow: 0 12px 40px rgba(16, 185, 129, 0.5);
    }

    .pub-fab-count {
        background: white;
        color: var(--pub-primary);
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="pub-container">
    <!-- Toast Container -->
    <div class="pub-toast-container" id="toastContainer"></div>

    <!-- Header -->
    <div class="pub-header">
        <div class="pub-title-section">
            <h1><i class="bi bi-file-earmark-pdf"></i> Publication-Ready Export</h1>
            <p>Generate LaTeX-ready figures and tables for academic publications</p>
        </div>
        <div class="pub-header-actions">
            <div class="pub-connection-status">
                <span class="pub-status-dot" id="connectionDot"></span>
                <span id="connectionText">Connecting...</span>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="pub-kpi-grid">
        <div class="pub-kpi-card figures">
            <div class="pub-kpi-header">
                <span class="pub-kpi-label">Figures</span>
                <div class="pub-kpi-icon"><i class="bi bi-bar-chart-line"></i></div>
            </div>
            <div class="pub-kpi-value" id="kpiFigures">6</div>
            <div class="pub-kpi-meta">3 selected for export</div>
        </div>
        <div class="pub-kpi-card tables">
            <div class="pub-kpi-header">
                <span class="pub-kpi-label">Tables</span>
                <div class="pub-kpi-icon" style="background: rgba(139, 92, 246, 0.2); color: var(--pub-secondary);"><i class="bi bi-table"></i></div>
            </div>
            <div class="pub-kpi-value" id="kpiTables">4</div>
            <div class="pub-kpi-meta">2 with booktabs</div>
        </div>
        <div class="pub-kpi-card exports">
            <div class="pub-kpi-header">
                <span class="pub-kpi-label">Total Exports</span>
                <div class="pub-kpi-icon" style="background: rgba(59, 130, 246, 0.2); color: var(--pub-info);"><i class="bi bi-download"></i></div>
            </div>
            <div class="pub-kpi-value" id="kpiExports">15</div>
            <div class="pub-kpi-meta">PDF + SVG + EPS</div>
        </div>
        <div class="pub-kpi-card quality">
            <div class="pub-kpi-header">
                <span class="pub-kpi-label">Quality Score</span>
                <div class="pub-kpi-icon" style="background: rgba(245, 158, 11, 0.2); color: var(--pub-warning);"><i class="bi bi-star-fill"></i></div>
            </div>
            <div class="pub-kpi-value" id="kpiQuality">92%</div>
            <div class="pub-kpi-meta">Publication ready</div>
        </div>
        <div class="pub-kpi-card venue">
            <div class="pub-kpi-header">
                <span class="pub-kpi-label">Target Venue</span>
                <div class="pub-kpi-icon" style="background: rgba(0, 98, 155, 0.2); color: var(--pub-ieee);"><i class="bi bi-journal-text"></i></div>
            </div>
            <div class="pub-kpi-value" id="kpiVenue">IEEE</div>
            <div class="pub-kpi-meta">Transactions format</div>
        </div>
    </div>

    <!-- Venue Selector -->
    <div class="pub-venue-section">
        <h3><i class="bi bi-building"></i> Publication Venue</h3>
        <div class="pub-venue-grid">
            <div class="pub-venue-card selected" data-venue="ieee" onclick="selectVenue(this, 'ieee')">
                <div class="pub-venue-logo">IEEE</div>
                <div class="pub-venue-name">IEEE Transactions</div>
                <div class="pub-venue-specs">3.5" column, Times, 9pt</div>
            </div>
            <div class="pub-venue-card" data-venue="acm" onclick="selectVenue(this, 'acm')">
                <div class="pub-venue-logo">ACM</div>
                <div class="pub-venue-name">ACM Journals</div>
                <div class="pub-venue-specs">3.33" column, Helvetica, 9pt</div>
            </div>
            <div class="pub-venue-card" data-venue="springer" onclick="selectVenue(this, 'springer')">
                <div class="pub-venue-logo">Springer</div>
                <div class="pub-venue-name">Springer Nature</div>
                <div class="pub-venue-specs">84mm column, Times, 10pt</div>
            </div>
            <div class="pub-venue-card" data-venue="elsevier" onclick="selectVenue(this, 'elsevier')">
                <div class="pub-venue-logo">Elsevier</div>
                <div class="pub-venue-name">Elsevier Journals</div>
                <div class="pub-venue-specs">90mm column, Times, 10pt</div>
            </div>
            <div class="pub-venue-card" data-venue="nature" onclick="selectVenue(this, 'nature')">
                <div class="pub-venue-logo">Nature</div>
                <div class="pub-venue-name">Nature Portfolio</div>
                <div class="pub-venue-specs">89mm column, Helvetica, 8pt</div>
            </div>
            <div class="pub-venue-card" data-venue="arxiv" onclick="selectVenue(this, 'arxiv')">
                <div class="pub-venue-logo">arXiv</div>
                <div class="pub-venue-name">arXiv Preprint</div>
                <div class="pub-venue-specs">Full width, CM, 10pt</div>
            </div>
        </div>
    </div>

    <!-- Export Types -->
    <div class="pub-export-types">
        <div class="pub-export-card selected" onclick="toggleExportType(this, 'figures')">
            <div class="pub-export-icon">ðŸ“Š</div>
            <h4>Figures</h4>
            <p>Charts & graphs as vector graphics</p>
            <span class="pub-export-count">6 items</span>
        </div>
        <div class="pub-export-card" onclick="toggleExportType(this, 'tables')">
            <div class="pub-export-icon">ðŸ“‹</div>
            <h4>Tables</h4>
            <p>LaTeX tabular environments</p>
            <span class="pub-export-count">4 items</span>
        </div>
        <div class="pub-export-card" onclick="toggleExportType(this, 'code')">
            <div class="pub-export-icon">ðŸ’»</div>
            <h4>Code Listings</h4>
            <p>lstlisting / minted format</p>
            <span class="pub-export-count">3 items</span>
        </div>
        <div class="pub-export-card" onclick="toggleExportType(this, 'bibtex')">
            <div class="pub-export-icon">ðŸ“š</div>
            <h4>BibTeX</h4>
            <p>Bibliography entries</p>
            <span class="pub-export-count">12 refs</span>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="pub-main-grid">
        <!-- Figure Gallery -->
        <div class="pub-figure-gallery">
            <div class="pub-gallery-header">
                <h3><i class="bi bi-images"></i> Figure Gallery</h3>
                <div class="pub-gallery-actions">
                    <button class="pub-btn pub-btn-secondary" onclick="selectAllFigures()">
                        <i class="bi bi-check-all"></i> Select All
                    </button>
                    <button class="pub-btn pub-btn-secondary" onclick="previewFigures()">
                        <i class="bi bi-eye"></i> Preview
                    </button>
                </div>
            </div>
            <div class="pub-gallery-grid">
                <div class="pub-figure-item selected" onclick="toggleFigure(this)" data-fig="training">
                    <div class="pub-figure-preview" id="figPreviewTraining"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name"><i class="bi bi-check-circle-fill check"></i> fig_training.pdf</div>
                        <div class="pub-figure-type">Loss & Accuracy Curves</div>
                    </div>
                </div>
                <div class="pub-figure-item selected" onclick="toggleFigure(this)" data-fig="confusion">
                    <div class="pub-figure-preview" id="figPreviewConfusion"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name"><i class="bi bi-check-circle-fill check"></i> fig_confusion.pdf</div>
                        <div class="pub-figure-type">Confusion Matrix</div>
                    </div>
                </div>
                <div class="pub-figure-item" onclick="toggleFigure(this)" data-fig="roc">
                    <div class="pub-figure-preview" id="figPreviewROC"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name">fig_roc.pdf</div>
                        <div class="pub-figure-type">ROC Curve (AUC=0.989)</div>
                    </div>
                </div>
                <div class="pub-figure-item selected" onclick="toggleFigure(this)" data-fig="comparison">
                    <div class="pub-figure-preview" id="figPreviewComparison"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name"><i class="bi bi-check-circle-fill check"></i> fig_comparison.pdf</div>
                        <div class="pub-figure-type">Model Comparison</div>
                    </div>
                </div>
                <div class="pub-figure-item" onclick="toggleFigure(this)" data-fig="shap">
                    <div class="pub-figure-preview" id="figPreviewSHAP"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name">fig_shap.pdf</div>
                        <div class="pub-figure-type">SHAP Feature Importance</div>
                    </div>
                </div>
                <div class="pub-figure-item" onclick="toggleFigure(this)" data-fig="architecture">
                    <div class="pub-figure-preview" id="figPreviewArch"></div>
                    <div class="pub-figure-overlay">
                        <button class="pub-btn pub-btn-primary"><i class="bi bi-eye"></i></button>
                    </div>
                    <div class="pub-figure-info">
                        <div class="pub-figure-name">fig_architecture.pdf</div>
                        <div class="pub-figure-type">System Architecture</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="pub-settings-panel">
            <h3><i class="bi bi-gear"></i> Export Settings</h3>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Figure Format</label>
                <select class="pub-select" id="figureFormat">
                    <option value="pdf">PDF (recommended)</option>
                    <option value="eps">EPS</option>
                    <option value="svg">SVG</option>
                    <option value="png">PNG (300 DPI)</option>
                </select>
            </div>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Figure Width</label>
                <select class="pub-select" id="figureWidth">
                    <option value="column">Column width (3.5 in)</option>
                    <option value="page">Page width (7 in)</option>
                    <option value="custom">Custom...</option>
                </select>
            </div>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Font Family</label>
                <select class="pub-select" id="fontFamily">
                    <option value="times">Times New Roman</option>
                    <option value="helvetica">Helvetica</option>
                    <option value="cm">Computer Modern</option>
                </select>
            </div>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Font Size</label>
                <select class="pub-select" id="fontSize">
                    <option value="8">8pt</option>
                    <option value="9" selected>9pt</option>
                    <option value="10">10pt</option>
                </select>
            </div>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Color Scheme</label>
                <select class="pub-select" id="colorScheme">
                    <option value="default">Default</option>
                    <option value="colorblind">Colorblind-safe</option>
                    <option value="grayscale">Grayscale</option>
                </select>
            </div>
            <div class="pub-settings-group">
                <label class="pub-settings-label">Table Style</label>
                <select class="pub-select" id="tableStyle">
                    <option value="booktabs">booktabs (recommended)</option>
                    <option value="standard">Standard LaTeX</option>
                    <option value="longtable">longtable</option>
                </select>
            </div>
        </div>
    </div>

    <!-- LaTeX Preview -->
    <div class="pub-latex-section">
        <div class="pub-latex-header">
            <h3><i class="bi bi-code-slash"></i> LaTeX Preview</h3>
            <div class="pub-gallery-actions">
                <button class="pub-btn pub-btn-secondary" onclick="copyLatex()">
                    <i class="bi bi-clipboard"></i> Copy
                </button>
                <button class="pub-btn pub-btn-secondary" onclick="downloadLatex()">
                    <i class="bi bi-download"></i> Download .tex
                </button>
            </div>
        </div>
        <div class="pub-latex-tabs">
            <button class="pub-latex-tab active" onclick="showLatexTab('figure')">Figure</button>
            <button class="pub-latex-tab" onclick="showLatexTab('table')">Table</button>
            <button class="pub-latex-tab" onclick="showLatexTab('bibtex')">BibTeX</button>
            <button class="pub-latex-tab" onclick="showLatexTab('preamble')">Preamble</button>
        </div>
        <div class="pub-latex-code" id="latexCode">
<span class="cmt">% Figure: Model Performance Comparison</span>
<span class="cmd">\begin</span><span class="brk">{</span>figure<span class="brk">}</span>[htbp]
    <span class="cmd">\centering</span>
    <span class="cmd">\includegraphics</span>[width=<span class="cmd">\columnwidth</span>]<span class="brk">{</span>figures/fig_comparison.pdf<span class="brk">}</span>
    <span class="cmd">\caption</span><span class="brk">{</span><span class="str">Comparison of model performance metrics across
    different architectures. Our proposed Quality Classifier v2.1
    achieves 96.8\% accuracy, representing a 2.3 percentage point
    improvement over the baseline model.</span><span class="brk">}</span>
    <span class="cmd">\label</span><span class="brk">{</span>fig:comparison<span class="brk">}</span>
<span class="cmd">\end</span><span class="brk">{</span>figure<span class="brk">}</span>
        </div>
    </div>

    <!-- Checklist -->
    <div class="pub-main-grid" style="margin-top: 1.5rem;">
        <div class="pub-checklist-section">
            <h3><i class="bi bi-check2-square"></i> Pre-Export Checklist</h3>
            <ul class="pub-checklist">
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check1" checked>
                    <label class="pub-checklist-label" for="check1">All figures have descriptive captions</label>
                    <span class="pub-checklist-badge pass">PASS</span>
                </li>
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check2" checked>
                    <label class="pub-checklist-label" for="check2">Labels are legible at publication size</label>
                    <span class="pub-checklist-badge pass">PASS</span>
                </li>
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check3">
                    <label class="pub-checklist-label" for="check3">Color scheme is colorblind-safe</label>
                    <span class="pub-checklist-badge warn">CHECK</span>
                </li>
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check4" checked>
                    <label class="pub-checklist-label" for="check4">Statistical significance is indicated</label>
                    <span class="pub-checklist-badge pass">PASS</span>
                </li>
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check5" checked>
                    <label class="pub-checklist-label" for="check5">Error bars / confidence intervals included</label>
                    <span class="pub-checklist-badge pass">PASS</span>
                </li>
                <li class="pub-checklist-item">
                    <input type="checkbox" class="pub-checkbox" id="check6" checked>
                    <label class="pub-checklist-label" for="check6">Axis labels include units</label>
                    <span class="pub-checklist-badge pass">PASS</span>
                </li>
            </ul>
        </div>
        <div></div>
    </div>
</div>

<!-- Export Progress Overlay -->
<div class="pub-export-progress" id="exportProgress">
    <div class="pub-progress-header">
        <h4><i class="bi bi-gear-wide-connected"></i> Exporting...</h4>
        <button class="pub-btn pub-btn-secondary" onclick="cancelExport()">
            <i class="bi bi-x"></i>
        </button>
    </div>
    <div class="pub-progress-bar">
        <div class="pub-progress-fill" id="progressFill"></div>
    </div>
    <div class="pub-progress-status" id="progressStatus">Preparing files...</div>
    <div class="pub-progress-files" id="progressFiles"></div>
</div>

<!-- FAB Export Button -->
<button class="pub-fab" onclick="exportAll()">
    <i class="bi bi-download"></i>
    Export Selected
    <span class="pub-fab-count" id="fabCount">3</span>
</button>

<script>
// State
let currentVenue = 'ieee';
let selectedExportTypes = ['figures'];
let selectedFigures = ['training', 'confusion', 'comparison'];

// Socket Connection
let socket;

function initSocket() {
    socket = io('/research', {
        transports: ['websocket', 'polling'],
        reconnection: true
    });

    socket.on('connect', () => {
        updateConnectionStatus(true);
        showToast('success', 'Connected', 'Export service ready');
    });

    socket.on('disconnect', () => {
        updateConnectionStatus(false);
    });

    socket.on('export_progress', (data) => {
        updateExportProgress(data);
    });
}

function updateConnectionStatus(connected) {
    const dot = document.getElementById('connectionDot');
    const text = document.getElementById('connectionText');
    dot.classList.toggle('connected', connected);
    text.textContent = connected ? 'Connected' : 'Disconnected';
}

// Toast
function showToast(type, title, message) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `pub-toast ${type}`;
    const icons = { success: 'bi-check-circle-fill', error: 'bi-x-circle-fill', info: 'bi-info-circle-fill' };
    toast.innerHTML = `
        <i class="bi ${icons[type]} pub-toast-icon"></i>
        <div class="pub-toast-content">
            <div class="pub-toast-title">${title}</div>
            <div class="pub-toast-message">${message}</div>
        </div>
        <button class="pub-toast-close" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
        </button>
    `;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
}

// Venue Selection
function selectVenue(el, venue) {
    document.querySelectorAll('.pub-venue-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    currentVenue = venue;
    document.getElementById('kpiVenue').textContent = venue.toUpperCase();

    // Apply venue settings
    const settings = {
        ieee: { width: 'column', font: 'times', size: '9' },
        acm: { width: 'column', font: 'helvetica', size: '9' },
        springer: { width: 'column', font: 'times', size: '10' },
        elsevier: { width: 'column', font: 'times', size: '10' },
        nature: { width: 'column', font: 'helvetica', size: '8' },
        arxiv: { width: 'page', font: 'cm', size: '10' }
    };

    if (settings[venue]) {
        document.getElementById('figureWidth').value = settings[venue].width;
        document.getElementById('fontFamily').value = settings[venue].font;
        document.getElementById('fontSize').value = settings[venue].size;
    }

    showToast('info', 'Venue Changed', `Settings updated for ${venue.toUpperCase()}`);
}

// Export Type Toggle
function toggleExportType(el, type) {
    el.classList.toggle('selected');
    if (el.classList.contains('selected')) {
        selectedExportTypes.push(type);
    } else {
        selectedExportTypes = selectedExportTypes.filter(t => t !== type);
    }
}

// Figure Selection
function toggleFigure(el) {
    el.classList.toggle('selected');
    const fig = el.dataset.fig;
    const nameEl = el.querySelector('.pub-figure-name');

    if (el.classList.contains('selected')) {
        selectedFigures.push(fig);
        nameEl.innerHTML = `<i class="bi bi-check-circle-fill check"></i> ${nameEl.textContent.replace('âœ“ ', '')}`;
    } else {
        selectedFigures = selectedFigures.filter(f => f !== fig);
        nameEl.innerHTML = nameEl.textContent.replace('âœ“ ', '');
    }

    document.getElementById('fabCount').textContent = selectedFigures.length;
}

function selectAllFigures() {
    document.querySelectorAll('.pub-figure-item').forEach(el => {
        if (!el.classList.contains('selected')) {
            el.classList.add('selected');
            selectedFigures.push(el.dataset.fig);
            const nameEl = el.querySelector('.pub-figure-name');
            nameEl.innerHTML = `<i class="bi bi-check-circle-fill check"></i> ${nameEl.textContent}`;
        }
    });
    document.getElementById('fabCount').textContent = selectedFigures.length;
}

// LaTeX Tabs
function showLatexTab(tab) {
    document.querySelectorAll('.pub-latex-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');

    const code = document.getElementById('latexCode');
    const templates = {
        figure: `<span class="cmt">% Figure: Model Performance Comparison</span>
<span class="cmd">\\begin</span><span class="brk">{</span>figure<span class="brk">}</span>[htbp]
    <span class="cmd">\\centering</span>
    <span class="cmd">\\includegraphics</span>[width=<span class="cmd">\\columnwidth</span>]<span class="brk">{</span>figures/fig_comparison.pdf<span class="brk">}</span>
    <span class="cmd">\\caption</span><span class="brk">{</span><span class="str">Comparison of model performance metrics across
    different architectures. Our proposed Quality Classifier v2.1
    achieves 96.8\\% accuracy.</span><span class="brk">}</span>
    <span class="cmd">\\label</span><span class="brk">{</span>fig:comparison<span class="brk">}</span>
<span class="cmd">\\end</span><span class="brk">{</span>figure<span class="brk">}</span>`,
        table: `<span class="cmt">% Table: Performance Metrics</span>
<span class="cmd">\\begin</span><span class="brk">{</span>table<span class="brk">}</span>[htbp]
    <span class="cmd">\\centering</span>
    <span class="cmd">\\caption</span><span class="brk">{</span><span class="str">Performance Metrics Comparison</span><span class="brk">}</span>
    <span class="cmd">\\label</span><span class="brk">{</span>tab:metrics<span class="brk">}</span>
    <span class="cmd">\\begin</span><span class="brk">{</span>tabular<span class="brk">}</span><span class="brk">{</span>lcc<span class="brk">}</span>
        <span class="cmd">\\toprule</span>
        Metric & v2.1.0 & v1.5.0 <span class="cmd">\\\\</span>
        <span class="cmd">\\midrule</span>
        Accuracy & <span class="cmd">\\textbf</span><span class="brk">{</span>96.8\\%<span class="brk">}</span> & 94.5\\% <span class="cmd">\\\\</span>
        F1 Score & <span class="cmd">\\textbf</span><span class="brk">{</span>0.954<span class="brk">}</span> & 0.926 <span class="cmd">\\\\</span>
        <span class="cmd">\\bottomrule</span>
    <span class="cmd">\\end</span><span class="brk">{</span>tabular<span class="brk">}</span>
<span class="cmd">\\end</span><span class="brk">{</span>table<span class="brk">}</span>`,
        bibtex: `<span class="cmt">% BibTeX entries for references</span>
<span class="cmd">@article</span><span class="brk">{</span>smith2024quality,
    author = <span class="brk">{</span><span class="str">Smith, John and Doe, Jane</span><span class="brk">}</span>,
    title = <span class="brk">{</span><span class="str">Deep Learning for Manufacturing Quality</span><span class="brk">}</span>,
    journal = <span class="brk">{</span><span class="str">IEEE Trans. Industrial Informatics</span><span class="brk">}</span>,
    year = <span class="brk">{</span>2024<span class="brk">}</span>,
    volume = <span class="brk">{</span>20<span class="brk">}</span>,
    number = <span class="brk">{</span>3<span class="brk">}</span>,
    pages = <span class="brk">{</span>1234--1245<span class="brk">}</span>
<span class="brk">}</span>`,
        preamble: `<span class="cmt">% Required packages for figures</span>
<span class="cmd">\\usepackage</span><span class="brk">{</span>graphicx<span class="brk">}</span>
<span class="cmd">\\usepackage</span><span class="brk">{</span>booktabs<span class="brk">}</span>
<span class="cmd">\\usepackage</span><span class="brk">{</span>amsmath<span class="brk">}</span>
<span class="cmd">\\usepackage</span><span class="brk">{</span>siunitx<span class="brk">}</span>

<span class="cmt">% Figure path</span>
<span class="cmd">\\graphicspath</span><span class="brk">{{</span>./figures/<span class="brk">}}</span>

<span class="cmt">% Custom commands</span>
<span class="cmd">\\newcommand</span><span class="brk">{</span><span class="cmd">\\figref</span><span class="brk">}</span>[1]<span class="brk">{</span>Figure~<span class="cmd">\\ref</span><span class="brk">{</span>#1<span class="brk">}}</span>
<span class="cmd">\\newcommand</span><span class="brk">{</span><span class="cmd">\\tabref</span><span class="brk">}</span>[1]<span class="brk">{</span>Table~<span class="cmd">\\ref</span><span class="brk">{</span>#1<span class="brk">}}</span>`
    };

    code.innerHTML = templates[tab] || templates.figure;
}

// Export Functions
function exportAll() {
    const progressEl = document.getElementById('exportProgress');
    progressEl.classList.add('active');

    const files = selectedFigures.map(f => `fig_${f}.pdf`);
    document.getElementById('progressFiles').innerHTML = files.map(f =>
        `<div class="pub-progress-file pending"><i class="bi bi-hourglass"></i> ${f}</div>`
    ).join('');

    let progress = 0;
    const interval = setInterval(() => {
        progress += 5;
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('progressStatus').textContent = `Exporting... ${progress}%`;

        // Mark files as done
        const filesEls = document.querySelectorAll('.pub-progress-file');
        const doneCount = Math.floor(progress / (100 / files.length));
        filesEls.forEach((el, i) => {
            if (i < doneCount) {
                el.classList.remove('pending');
                el.classList.add('done');
                el.innerHTML = `<i class="bi bi-check-circle-fill"></i> ${files[i]}`;
            }
        });

        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                progressEl.classList.remove('active');
                showToast('success', 'Export Complete', `${files.length} files exported to /exports`);
            }, 500);
        }
    }, 150);

    // Send to API
    fetch('/api/v6/research/export/publication', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            venue: currentVenue,
            figures: selectedFigures,
            settings: {
                format: document.getElementById('figureFormat').value,
                width: document.getElementById('figureWidth').value,
                font: document.getElementById('fontFamily').value,
                fontSize: document.getElementById('fontSize').value,
                colorScheme: document.getElementById('colorScheme').value,
                tableStyle: document.getElementById('tableStyle').value
            }
        })
    });
}

function cancelExport() {
    document.getElementById('exportProgress').classList.remove('active');
    showToast('info', 'Export Cancelled', 'Export was cancelled');
}

function copyLatex() {
    const code = document.getElementById('latexCode').textContent;
    navigator.clipboard.writeText(code);
    showToast('success', 'Copied', 'LaTeX code copied to clipboard');
}

function downloadLatex() {
    showToast('info', 'Downloading', 'Preparing .tex file...');
}

function previewFigures() {
    showToast('info', 'Preview', 'Full-size preview would open');
}

// Mini Figure Previews
function initFigurePreviews() {
    const previews = {
        Training: { type: 'scatter', x: [1,2,3,4,5], y: [0.9, 0.7, 0.4, 0.2, 0.1] },
        Confusion: { type: 'heatmap', z: [[9,1,0],[0,9,1],[0,0,10]] },
        ROC: { type: 'scatter', x: [0,0.1,0.3,1], y: [0,0.9,0.95,1] },
        Comparison: { type: 'bar', x: ['v2.1','v1.5'], y: [96.8, 94.5] },
        SHAP: { type: 'bar', x: ['F1','F2','F3'], y: [0.5,0.3,0.2] },
        Arch: { type: 'scatter', x: [1,2,3,4], y: [1,2,2,3] }
    };

    Object.entries(previews).forEach(([name, data]) => {
        const container = document.getElementById(`figPreview${name}`);
        if (!container) return;

        const config = {
            displayModeBar: false,
            responsive: true
        };

        const layout = {
            margin: { t: 5, b: 5, l: 5, r: 5 },
            xaxis: { visible: false },
            yaxis: { visible: false },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            showlegend: false
        };

        Plotly.newPlot(container, [{ ...data, marker: { color: '#10b981' } }], layout, config);
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initSocket();
    initFigurePreviews();
    setTimeout(() => updateConnectionStatus(true), 1000);
});
</script>
{% endblock %}
