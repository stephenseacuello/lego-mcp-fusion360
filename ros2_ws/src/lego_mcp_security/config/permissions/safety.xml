<?xml version="1.0" encoding="UTF-8"?>
<!--
  DDS Permissions for Safety Node
  LEGO MCP Security - IEC 62443 Zone 0 (Safety - Highest Security)
-->
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="http://www.omg.org/spec/DDS-SECURITY/20170901/omg_shared_ca_permissions.xsd">
  <permissions>

    <grant name="safety_permissions">
      <subject_name>CN=safety_node,O=LegoMCP,OU=Zone0</subject_name>

      <validity>
        <not_before>2024-01-01T00:00:00</not_before>
        <not_after>2026-01-01T00:00:00</not_after>
      </validity>

      <allow_rule>
        <domains>
          <id>0</id>
        </domains>

        <!-- Safety node MUST be able to publish e-stop to ALL topics -->
        <publish>
          <topics>
            <topic>/lego_mcp/safety/*</topic>
            <topic>/lego_mcp/estop</topic>
            <topic>/safety/estop_status</topic>
            <topic>/lego_mcp/heartbeat/safety</topic>
            <topic>/diagnostics</topic>
          </topics>
        </publish>

        <!-- Safety node monitors all equipment -->
        <subscribe>
          <topics>
            <topic>/lego_mcp/equipment/*</topic>
            <topic>/lego_mcp/orchestrator/*</topic>
            <topic>/lego_mcp/heartbeat/*</topic>
            <topic>/joint_states</topic>
          </topics>
        </subscribe>
      </allow_rule>

      <!-- Safety node has NO restrictions on e-stop commands -->
      <!-- This is critical for ISO 10218 compliance -->

      <default>DENY</default>
    </grant>

  </permissions>
</dds>
