<?xml version="1.0" encoding="UTF-8"?>
<!--
  DDS Permissions for Equipment Nodes
  LEGO MCP Security - IEC 62443 Zone 1 (Control)

  Applies to: grbl_node, formlabs_node, bambu_node, calibration_node
-->
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="http://www.omg.org/spec/DDS-SECURITY/20170901/omg_shared_ca_permissions.xsd">
  <permissions>

    <!-- GRBL Node (CNC/Laser) -->
    <grant name="grbl_permissions">
      <subject_name>CN=grbl_node,O=LegoMCP,OU=Zone1</subject_name>

      <validity>
        <not_before>2024-01-01T00:00:00</not_before>
        <not_after>2026-01-01T00:00:00</not_after>
      </validity>

      <allow_rule>
        <domains>
          <id>0</id>
        </domains>

        <publish>
          <topics>
            <topic>/grbl_node/*</topic>
            <topic>/lego_mcp/equipment/grbl/*</topic>
            <topic>/lego_mcp/cnc/*</topic>
            <topic>/lego_mcp/heartbeat/grbl</topic>
            <topic>/joint_states</topic>
            <topic>/diagnostics</topic>
          </topics>
        </publish>

        <subscribe>
          <topics>
            <topic>/grbl_node/*</topic>
            <topic>/lego_mcp/orchestrator/commands</topic>
            <topic>/safety/estop_status</topic>
            <topic>/lego_mcp/estop</topic>
          </topics>
        </subscribe>
      </allow_rule>

      <default>DENY</default>
    </grant>

    <!-- Formlabs Node (SLA Printer) -->
    <grant name="formlabs_permissions">
      <subject_name>CN=formlabs_node,O=LegoMCP,OU=Zone1</subject_name>

      <validity>
        <not_before>2024-01-01T00:00:00</not_before>
        <not_after>2026-01-01T00:00:00</not_after>
      </validity>

      <allow_rule>
        <domains>
          <id>0</id>
        </domains>

        <publish>
          <topics>
            <topic>/formlabs_node/*</topic>
            <topic>/lego_mcp/equipment/formlabs/*</topic>
            <topic>/lego_mcp/printer/sla/*</topic>
            <topic>/lego_mcp/heartbeat/formlabs</topic>
            <topic>/diagnostics</topic>
          </topics>
        </publish>

        <subscribe>
          <topics>
            <topic>/formlabs_node/*</topic>
            <topic>/lego_mcp/orchestrator/commands</topic>
            <topic>/safety/estop_status</topic>
            <topic>/lego_mcp/estop</topic>
          </topics>
        </subscribe>
      </allow_rule>

      <default>DENY</default>
    </grant>

    <!-- Bambu Node (FDM Printer) -->
    <grant name="bambu_permissions">
      <subject_name>CN=bambu_node,O=LegoMCP,OU=Zone1</subject_name>

      <validity>
        <not_before>2024-01-01T00:00:00</not_before>
        <not_after>2026-01-01T00:00:00</not_after>
      </validity>

      <allow_rule>
        <domains>
          <id>0</id>
        </domains>

        <publish>
          <topics>
            <topic>/bambu_node/*</topic>
            <topic>/lego_mcp/equipment/bambu/*</topic>
            <topic>/lego_mcp/printer/fdm/*</topic>
            <topic>/lego_mcp/heartbeat/bambu</topic>
            <topic>/diagnostics</topic>
          </topics>
        </publish>

        <subscribe>
          <topics>
            <topic>/bambu_node/*</topic>
            <topic>/lego_mcp/orchestrator/commands</topic>
            <topic>/safety/estop_status</topic>
            <topic>/lego_mcp/estop</topic>
          </topics>
        </subscribe>
      </allow_rule>

      <default>DENY</default>
    </grant>

  </permissions>
</dds>
