<?xml version="1.0" encoding="UTF-8"?>
<!--
  DDS Permissions for Orchestrator Node
  LEGO MCP Security - IEC 62443 Zone 2 (Supervisory)
-->
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="http://www.omg.org/spec/DDS-SECURITY/20170901/omg_shared_ca_permissions.xsd">
  <permissions>

    <grant name="orchestrator_permissions">
      <subject_name>CN=orchestrator_node,O=LegoMCP,OU=Zone2</subject_name>

      <validity>
        <not_before>2024-01-01T00:00:00</not_before>
        <not_after>2026-01-01T00:00:00</not_after>
      </validity>

      <allow_rule>
        <domains>
          <id>0</id>
        </domains>

        <!-- Orchestrator can publish to -->
        <publish>
          <topics>
            <topic>/lego_mcp/orchestrator/*</topic>
            <topic>/lego_mcp/job/*</topic>
            <topic>/lego_mcp/status</topic>
            <topic>/lego_mcp/heartbeat/orchestrator</topic>
            <topic>/diagnostics</topic>
          </topics>
        </publish>

        <!-- Orchestrator can subscribe to -->
        <subscribe>
          <topics>
            <topic>/lego_mcp/equipment/*</topic>
            <topic>/lego_mcp/safety/*</topic>
            <topic>/lego_mcp/agv/*</topic>
            <topic>/lego_mcp/vision/*</topic>
            <topic>/lego_mcp/heartbeat/*</topic>
            <topic>/joint_states</topic>
            <topic>/tf</topic>
            <topic>/tf_static</topic>
          </topics>
        </subscribe>
      </allow_rule>

      <!-- Deny access to enterprise zone -->
      <deny_rule>
        <domains>
          <id>0</id>
        </domains>
        <publish>
          <topics>
            <topic>/lego_mcp/enterprise/*</topic>
            <topic>/lego_mcp/cloud/*</topic>
          </topics>
        </publish>
      </deny_rule>

      <default>DENY</default>
    </grant>

  </permissions>
</dds>
