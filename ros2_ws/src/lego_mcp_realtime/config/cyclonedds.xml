<?xml version="1.0" encoding="UTF-8"?>
<!--
  CycloneDDS Configuration for Real-Time Manufacturing

  Optimized for deterministic, low-latency communication.
  Reference: OMG DDS-RTPS, IEC 61784-3
-->
<CycloneDDS xmlns="https://cdds.io/config">
  <Domain id="any">
    <!-- General Settings -->
    <General>
      <!-- Bind to specific network interface -->
      <NetworkInterfaceAddress>auto</NetworkInterfaceAddress>

      <!-- Enable multicast for discovery -->
      <AllowMulticast>true</AllowMulticast>

      <!-- Maximum message size (for large sensor data) -->
      <MaxMessageSize>65500</MaxMessageSize>

      <!-- Fragment size for large messages -->
      <FragmentSize>4096</FragmentSize>
    </General>

    <!-- Discovery Configuration -->
    <Discovery>
      <!-- Participant index for deterministic port assignment -->
      <ParticipantIndex>auto</ParticipantIndex>

      <!-- Discovery multicast address -->
      <DefaultMulticastAddress>239.255.0.1</DefaultMulticastAddress>

      <!-- Peers for initial discovery (optional) -->
      <!-- <Peers>
        <Peer address="192.168.1.100"/>
        <Peer address="192.168.1.101"/>
      </Peers> -->
    </Discovery>

    <!-- Real-Time Optimizations -->
    <Internal>
      <!-- Socket receive buffer size -->
      <SocketReceiveBufferSize min="1MB"/>

      <!-- Socket send buffer size -->
      <SocketSendBufferSize min="1MB"/>

      <!-- Writer history depth -->
      <WriterLingerDuration>1s</WriterLingerDuration>

      <!-- Heartbeat interval for reliable comms -->
      <HeartbeatInterval>100ms</HeartbeatInterval>

      <!-- Nack response delay -->
      <NackDelay>10ms</NackDelay>

      <!-- Pre-emptive ack delay -->
      <PreEmptiveAckDelay>10ms</PreEmptiveAckDelay>

      <!-- Synchronous delivery mode (lower latency) -->
      <SynchronousDeliveryLatencyBound>inf</SynchronousDeliveryLatencyBound>

      <!-- Thread scheduling -->
      <RediscoveryBlacklistDuration>10s</RediscoveryBlacklistDuration>
    </Internal>

    <!-- Tracing (disable in production for performance) -->
    <Tracing>
      <Verbosity>warning</Verbosity>
      <OutputFile>stderr</OutputFile>
      <AppendToFile>false</AppendToFile>
    </Tracing>

    <!-- Domain-specific settings -->
    <Sizing>
      <!-- Maximum participants -->
      <ReceivingBufferSize>1MB</ReceivingBufferSize>
    </Sizing>

    <!-- Thread configuration for RT -->
    <Threads>
      <Thread name="recv">
        <StackSize>1MB</StackSize>
      </Thread>
      <Thread name="tev">
        <StackSize>512KB</StackSize>
      </Thread>
      <Thread name="gc">
        <StackSize>256KB</StackSize>
      </Thread>
    </Threads>

    <!-- Security (optional, enable for production) -->
    <!-- <Security>
      <Authentication>
        <Library path="dds_security_auth"/>
        <IdentityCertificate>file:/path/to/identity.pem</IdentityCertificate>
        <IdentityCA>file:/path/to/identity_ca.pem</IdentityCA>
        <PrivateKey>file:/path/to/private_key.pem</PrivateKey>
      </Authentication>
      <AccessControl>
        <Library path="dds_security_ac"/>
        <Governance>file:/path/to/governance.xml</Governance>
        <Permissions>file:/path/to/permissions.xml</Permissions>
        <PermissionsCA>file:/path/to/permissions_ca.pem</PermissionsCA>
      </AccessControl>
      <Cryptographic>
        <Library path="dds_security_crypto"/>
      </Cryptographic>
    </Security> -->
  </Domain>
</CycloneDDS>
